(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const N={jump:"jump-to-today.mp3",scroll:"year-change-scroll-transition.mp3",warp:"fast-scroll-wrap-mode.mp3",hover:"hover-over-cell.mp3",theme:"theme-toggle.mp3",beep:"confirmation-beep.mp3",enable:"enabled-ambience.mp3",mute:"mute-ambience.mp3",base:"master-ambient-loop.mp3",pulse:"short-ambient-pulse.mp3",wind:"nebula-wind-sweep.mp3",engine:"engine-idle-hum.mp3",stellar:"distant-stellar-ambience.mp3"};class R extends EventTarget{constructor(){super(),this._map=new Map}on(t,e){const i=s=>{const n=s.detail;try{e(n)}catch(r){setTimeout(()=>{throw r})}};return this._map.has(t)||this._map.set(t,new Map),this._map.get(t).set(e,i),this.addEventListener(t,i),()=>this.off(t,e)}off(t,e){const i=this._map.get(t);if(!i)return;if(!e){for(const n of i.values())this.removeEventListener(t,n);this._map.delete(t);return}const s=i.get(e);s&&(this.removeEventListener(t,s),i.delete(e),i.size===0&&this._map.delete(t))}once(t,e){const i=s=>{const n=s.detail;try{e(n)}catch(h){setTimeout(()=>{throw h})}const r=this._map.get(t);r&&(r.delete(e),r.size===0&&this._map.delete(t))};return this._map.has(t)||this._map.set(t,new Map),this._map.get(t).set(e,i),this.addEventListener(t,i,{once:!0}),()=>this.off(t,e)}emit(t,e){try{return this.dispatchEvent(new CustomEvent(t,{detail:e}))}catch(i){return setTimeout(()=>{throw i}),!1}}}const a=new R,Y=Object.freeze(Object.defineProperty({__proto__:null,default:a},Symbol.toStringTag,{value:"Module"})),o={AUDIO_PLAY:"audio:play",AUDIO_TOGGLE_MASTER:"audio:toggleMaster",AUDIO_TOGGLED:"audio:toggled",AUDIO_SET_BUSY:"audio:setBusy",AUDIO_INJECT_ENGINE_POWER:"audio:injectEnginePower",AUDIO_UPDATE_SPATIAL_POSITION:"audio:updateSpatialPosition",AUDIO_RESET_IDLE_TIMER:"audio:resetIdleTimer",AUDIO_SET_ENABLED:"audio:setEnabled",POWER_SAVING_CHANGED:"powerSaving:changed",TOAST_SHOW:"toast:show",APP_BOOTED:"app:booted",ANIMATION_SET_ENABLED:"animation:setEnabled",STATE_RESTORED:"state:restored",STATE_WARP:"state:warp",STATE_SAVED:"state:saved",NAV_WARP_START:"nav:warp:start",NAV_WARP_END:"nav:warp:end",NAV_SCROLL_START:"nav:scroll:start",NAV_SCROLL_END:"nav:scroll:end",NAV_MODE_CHANGED:"nav:modeChanged",UI_THEME_CHANGED:"ui:themeChanged",INPUT_POINTER_MOVE:"input:pointerMove",INPUT_HOVER:"input:hover",INPUT_CLICK:"input:click"},w={AUDIO_ENABLED:"audio_enabled",ODYSSEY_STATE:"odyssey_state",THEME:"theme"};function M(d,t=150){let e;return(...i)=>{e&&clearTimeout(e),e=setTimeout(()=>{d.apply(void 0,i)},t)}}const B=M((d,t=2500)=>{const e=document.getElementById("toast");e&&(e.innerText=d,e.classList.add("active"),e._toastTimer&&clearTimeout(e._toastTimer),e._toastTimer=setTimeout(()=>e.classList.remove("active"),t))},50);a.on(o.TOAST_SHOW,(d={})=>{const{msg:t,timeout:e}=typeof d=="string"?{msg:d}:d;t&&B(t,e)});function g(d,t=2500){a.emit(o.TOAST_SHOW,{msg:d,timeout:t})}var D={};function C(){return typeof navigator<"u"&&navigator.language?navigator.language:typeof process<"u"&&D.LANG?D.LANG.split(".")[0]:"en-US"}function U(d){const t=[];for(let e=0;e<12;e++){const i=new Date(2020,e,1);let s=new Intl.DateTimeFormat(d,{month:"short"}).format(i);s=s.replace(/\./g,"").toUpperCase().slice(0,3),t.push(s)}return t}function k(d){const t=[];for(let e=0;e<7;e++){const i=new Date(Date.UTC(2023,0,1+e));let s=new Intl.DateTimeFormat(d,{weekday:"short"}).format(i);s=s.replace(/\./g,"").toUpperCase().slice(0,3),t.push(s)}return t}const L=C(),u={temporal:{weekStart:1,totalYears:2e3,monthsShort:U(L),daysShort:k(L)},display:{defaultMode:"structured",centerContent:!0,minCols:7,warpDuration:1100},audio:{basePath:"assets/sfx/",masterVolume:.4,ambientBaseVolume:.12,idleInterval:[1e4,25e3],idleDelay:3e4},physics:{cursorInertia:.12,hoverThrottle:120,exhaustThreshold:15}};class G{constructor(){this._path=u.audio.basePath,this._sounds=new Map,this._ctx=null,this._masterGain=null,this._panner=null,this._ambientSources=new Map,this.enabled=!1,this.initialized=!1,this.isBusy=!1,this.idleTimer=null,this._unbinds=[],this._initAudioContext(),this._unbinds=[],this._unbinds.push(a.on(o.AUDIO_PLAY,t=>this.play(t==null?void 0:t.key,t==null?void 0:t.options))),this._unbinds.push(a.on(o.AUDIO_TOGGLE_MASTER,async()=>{const t=await this.toggleMaster();a.emit(o.AUDIO_TOGGLED,{enabled:t})})),this._unbinds.push(a.on(o.AUDIO_SET_BUSY,t=>this.setBusy(!!t))),this._unbinds.push(a.on(o.AUDIO_INJECT_ENGINE_POWER,t=>this.injectEnginePower(t))),this._unbinds.push(a.on(o.AUDIO_UPDATE_SPATIAL_POSITION,t=>this.updateSpatialPosition(t==null?void 0:t.x,t==null?void 0:t.y))),this._unbinds.push(a.on(o.AUDIO_RESET_IDLE_TIMER,()=>this.resetIdleTimer())),this._unbinds.push(a.on(o.AUDIO_SET_ENABLED,t=>this.setEnabled(t))),this._unbinds.push(a.on(o.POWER_SAVING_CHANGED,({enabled:t})=>{this.setEnabled(!t)}))}_initAudioContext(){const t=async()=>{this.initialized||(this._ctx=new(window.AudioContext||window.webkitAudioContext),this._masterGain=this._ctx.createGain(),this._masterGain.gain.value=u.audio.masterVolume,this._panner=this._ctx.createPanner(),this._panner.panningModel="HRTF",this._panner.distanceModel="inverse",this._panner.refDistance=1,this._panner.maxDistance=1e4,this._panner.rolloffFactor=1,this._panner.connect(this._masterGain),this._masterGain.connect(this._ctx.destination),await this._loadAssets(),this.initialized=!0)};["click","touchstart","keydown"].forEach(e=>window.addEventListener(e,t,{once:!0}))}injectEnginePower(t){if(!this.enabled||!this.initialized)return;const e=Math.min(t/120,1);if(e>.15){const i=Date.now();(!this._lastEnginePlay||i-this._lastEnginePlay>100)&&(this.play("hover",{volume:u.audio.masterVolume*e*.3,playbackRate:.4+e*1.2}),this._lastEnginePlay=i)}if(this._masterGain&&this._ctx){const i=u.audio.masterVolume*(1+e*.4);this._masterGain.gain.setTargetAtTime(i,this._ctx.currentTime,.08)}}async _loadAssets(){const t=N;for(const[e,i]of Object.entries(t))try{const n=await(await fetch(`${this._path}${i}`)).arrayBuffer();this._ctx&&this._sounds.set(e,await this._ctx.decodeAudioData(n))}catch{}}updateSpatialPosition(t,e){if(!this.initialized||!this._panner||!this._ctx)return;const i=t/window.innerWidth*2-1,s=-(e/window.innerHeight)*2+1;this._panner.positionX.setTargetAtTime(i,this._ctx.currentTime,.1),this._panner.positionY.setTargetAtTime(s,this._ctx.currentTime,.1),this._panner.positionZ.setTargetAtTime(.5,this._ctx.currentTime,.1)}play(t,e={}){if(!this.enabled||!this.initialized||!this._sounds.has(t)||this.isBusy&&t==="hover"||!this._ctx)return;const i=this._ctx.createBufferSource();i.buffer=this._sounds.get(t)||null;const s=this._ctx.createGain();s.gain.value=e.volume??1,i.playbackRate.value=e.playbackRate||1,i.connect(s),["hover","beep","pulse","wind"].includes(t)&&this._panner?s.connect(this._panner):this._masterGain&&s.connect(this._masterGain),e.loop&&(i.loop=!0,this._ambientSources.set(t,i)),i.start(0)}async toggleMaster(){this.initialized||await this._waitForInitialization(),this.enabled=!this.enabled;try{localStorage.setItem(w.AUDIO_ENABLED,String(this.enabled))}catch{}if(this.enabled)try{this._ctx&&this._ctx.state==="suspended"&&await this._ctx.resume(),this.play("enable"),this.play("base",{volume:u.audio.ambientBaseVolume,loop:!0}),this.resetIdleTimer()}catch{g("Audio System Initialization Failed",2e3),this.enabled=!1}else this.play("mute"),this._ambientSources.forEach(t=>t.stop()),this._ambientSources.clear(),clearTimeout(this.idleTimer);return a.emit(o.AUDIO_TOGGLED,{enabled:this.enabled}),this.enabled}async setEnabled(t){return this.initialized?this.enabled===t?this.enabled:await this.toggleMaster():!1}async _waitForInitialization(){return new Promise(t=>{if(this.initialized)t();else{const e=setInterval(()=>{this.initialized&&(clearInterval(e),t())},50);setTimeout(()=>{clearInterval(e),t()},5e3)}})}resetIdleTimer(){this.enabled&&(clearTimeout(this.idleTimer),this.idleTimer=setTimeout(()=>this._triggerRandomIdleClip(),u.audio.idleDelay))}_triggerRandomIdleClip(){if(!this.enabled||this.isBusy)return;const t=[{k:"pulse",v:.15},{k:"wind",v:.2},{k:"engine",v:.15},{k:"stellar",v:.2}],e=t[Math.floor(Math.random()*t.length)];this.play(e.k,{volume:e.v});const[i,s]=u.audio.idleInterval;this.idleTimer=setTimeout(()=>this._triggerRandomIdleClip(),Math.random()*(s-i)+i)}setBusy(t){this.isBusy=t,this._masterGain&&this._ctx&&this._masterGain.gain.setTargetAtTime(t?.1:u.audio.masterVolume,this._ctx.currentTime,.5)}}function O(d,t){"style"in d&&Object.assign(d.style,t)}const H="modulepreload",F=function(d){return"https://ledihildawan.github.io/galactic-odyssey/"+d},P={},z=function(t,e,i){let s=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),h=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));s=Promise.allSettled(e.map(c=>{if(c=F(c),c in P)return;P[c]=!0;const l=c.endsWith(".css"),p=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${p}`))return;const _=document.createElement("link");if(_.rel=l?"stylesheet":H,l||(_.as="script"),_.crossOrigin="",_.href=c,h&&_.setAttribute("nonce",h),document.head.appendChild(_),l)return new Promise((v,y)=>{_.addEventListener("load",v),_.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(r){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=r,window.dispatchEvent(h),!h.defaultPrevented)throw r}return s.then(r=>{for(const h of r||[])h.status==="rejected"&&n(h.reason);return t().catch(n)})},V="attribute vec2 a_pos;attribute vec2 a_vel;attribute float a_life;attribute float a_size;attribute vec3 a_color;varying float v_life;varying vec3 v_color;uniform vec2 u_res;void main(){vec2 clipSpace=(a_pos/u_res)*2.0-1.0;gl_Position=vec4(clipSpace.x,-clipSpace.y,0,1);float speed=length(a_vel);gl_PointSize=a_size*a_life*(1.0+speed*0.05);v_life=a_life;v_color=a_color;}",W="precision mediump float;varying float v_life;varying vec3 v_color;uniform float u_isLight;void main(){float d=distance(gl_PointCoord,vec2(0.5));if(d>0.5) discard;float intensity=(u_isLight>0.5)?1.8:2.5;float glow=pow(1.0-(d*2.0),intensity);gl_FragColor=vec4(v_color,glow*v_life);}";class ${constructor(){this.buffers=null,this.program=null,this.uniLocs=null,this.canvas=document.createElement("canvas"),this.gl=this.canvas.getContext("webgl",{alpha:!0,antialias:!1,depth:!1,preserveDrawingBuffer:!1}),this.particles=[],this.maxParticles=1200,this.animationsEnabled=!0,this.init(),z(async()=>{const{default:t}=await Promise.resolve().then(()=>Y);return{default:t}},void 0).then(({default:t})=>{t.on(o.ANIMATION_SET_ENABLED,e=>{this.animationsEnabled=e,e?this.loop():(this.particles=[],this.gl&&(this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)))})})}getCSSColor(t){const e=getComputedStyle(document.documentElement).getPropertyValue(t).trim();if(e.startsWith("#")){const i=parseInt(e.slice(1,3),16)/255,s=parseInt(e.slice(3,5),16)/255,n=parseInt(e.slice(5,7),16)/255;return[i,s,n]}return[.5,.5,.5]}init(){const t=document.documentElement.getAttribute("data-theme")==="light";if(Object.assign(this.canvas.style,{position:"fixed",inset:"0",zIndex:"2",pointerEvents:"none",mixBlendMode:t?"normal":"screen"}),document.body.appendChild(this.canvas),!this.gl)return;const e=this.gl;this.buffers={pos:e.createBuffer(),vel:e.createBuffer(),life:e.createBuffer(),size:e.createBuffer(),color:e.createBuffer()},this.program=this.createProgram(V,W),this.resize(),window.addEventListener("resize",()=>this.resize()),this.loop()}createProgram(t,e){const i=this.gl,s=(r,h)=>{const c=i.createShader(r);return i.shaderSource(c,h),i.compileShader(c),c},n=i.createProgram();return i.attachShader(n,s(i.VERTEX_SHADER,t)),i.attachShader(n,s(i.FRAGMENT_SHADER,e)),i.linkProgram(n),n}resize(){if(!this.animationsEnabled)return;const t=Math.min(window.devicePixelRatio,2);this.canvas.width=Math.round(window.innerWidth*t),this.canvas.height=Math.round(window.innerHeight*t),this.canvas.style.width=`${window.innerWidth}px`,this.canvas.style.height=`${window.innerHeight}px`,this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}spawn(t,e,i=!1){if(!this.animationsEnabled)return;const s=Math.min(window.devicePixelRatio,2),n=i?2:12;let r=this.getCSSColor("--ion-primary"),h=this.getCSSColor("--ion-secondary");document.documentElement.getAttribute("data-theme")==="light"&&(r=r.map(l=>l*.75),h=h.map(l=>l*.75));for(let c=0;c<n;c++){this.particles.length>=this.maxParticles&&this.particles.shift();const l=Math.random()*Math.PI*2,p=i?Math.random()*2:Math.random()*5+1.5;this.particles.push({x:t*s,y:e*s,vx:Math.cos(l)*p*s,vy:Math.sin(l)*p*s,life:1,decay:i?.04:.015,size:(i?8:22)*s,color:i?r:h})}}loop(){if(!this.animationsEnabled)return;const t=this.gl;if(!t)return;if(t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),this.particles.length===0){requestAnimationFrame(()=>this.loop());return}t.enable(t.BLEND);const e=document.documentElement.getAttribute("data-theme")==="light";this.canvas.style.mixBlendMode=e?"normal":"screen",e?t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA):t.blendFunc(t.SRC_ALPHA,t.ONE),this.uniLocs||(this.uniLocs={isLight:t.getUniformLocation(this.program,"u_isLight"),res:t.getUniformLocation(this.program,"u_res")});const i=[],s=[],n=[],r=[],h=[];for(let c=this.particles.length-1;c>=0;c--){const l=this.particles[c];if(l.x+=l.vx,l.y+=l.vy,l.vx*=.98,l.vy*=.98,l.life-=l.decay,l.life<=0){this.particles[c]=this.particles[this.particles.length-1],this.particles.pop();continue}i.push(l.x,l.y),s.push(l.vx,l.vy),n.push(l.life),r.push(l.size),h.push(...l.color)}i.length>0&&(t.useProgram(this.program),this.updateBuffer(new Float32Array(i),this.buffers.pos,"a_pos",2),this.updateBuffer(new Float32Array(s),this.buffers.vel,"a_vel",2),this.updateBuffer(new Float32Array(n),this.buffers.life,"a_life",1),this.updateBuffer(new Float32Array(r),this.buffers.size,"a_size",1),this.updateBuffer(new Float32Array(h),this.buffers.color,"a_color",3),t.uniform1f(this.uniLocs.isLight,e?1:0),t.uniform2f(this.uniLocs.res,this.canvas.width,this.canvas.height),t.drawArrays(t.POINTS,0,i.length/2)),requestAnimationFrame(()=>this.loop())}updateBuffer(t,e,i,s){const n=this.gl,r=n.getAttribLocation(this.program,i);r!==-1&&(n.bindBuffer(n.ARRAY_BUFFER,e),n.bufferData(n.ARRAY_BUFFER,t,n.DYNAMIC_DRAW),n.enableVertexAttribArray(r),n.vertexAttribPointer(r,s,n.FLOAT,!1,0,0))}}const A=class A{constructor(){this._activeYears=new Map,this._today=new Date,this._particles=new $,this._viewport=document.getElementById("viewport"),this._canvas=document.getElementById("infinite-canvas"),this._ionDrive=document.getElementById("ion-drive"),this._lastScrollPos=0,this._isScrolling=!1,this._isWarping=!1,this._isInteractingAllowed=!0,this._mouse={x:window.innerWidth/2,y:window.innerHeight/2},this._current={x:window.innerWidth/2,y:window.innerHeight/2},this._lastMouse={x:0,y:0},this._isRandomMode=u.display.defaultMode==="random",this.observer=null,this.ticking=!1,this.totalYears=u.temporal.totalYears,this.yearHeight=window.innerHeight,this.startY=this.totalYears/2*this.yearHeight,this.animationsEnabled=!0,this._loadState(),a.on(o.AUDIO_TOGGLED,(t={})=>{g(t.enabled?"Ion Drive System Online":"Audio Systems Disabled"),this._saveState()}),a.on(o.ANIMATION_SET_ENABLED,t=>{this.animationsEnabled=t,t&&this._cursorLoop()}),this._runBoot()}_loadState(){const t=localStorage.getItem(w.ODYSSEY_STATE);if(t)try{const e=JSON.parse(t);this._isRandomMode=e.isRandomMode??this._isRandomMode,e.scrollPosition&&(this.startY=e.scrollPosition),a.emit(o.STATE_RESTORED,e)}catch{g("System State Restoration Failed",2e3)}}_saveState(){var t;try{const e=localStorage.getItem(w.AUDIO_ENABLED)!=="false",i={theme:document.documentElement.getAttribute("data-theme"),isRandomMode:this._isRandomMode,scrollPosition:((t=this._viewport)==null?void 0:t.scrollTop)||this.startY,audioEnabled:e,lastVisit:new Date().toISOString()};localStorage.setItem(w.ODYSSEY_STATE,JSON.stringify(i)),a.emit(o.STATE_SAVED,i)}catch{g("System State Backup Failed",2e3)}}async _runBoot(){const t=document.getElementById("load-progress"),e=[{p:40,t:"Initializing Navigation Systems"},{p:80,t:"Calibrating Audio Processors"},{p:100,t:"Systems Ready for Departure"}];for(const i of e)await new Promise(s=>setTimeout(s,400)),t.style.width=`${i.p}%`,document.getElementById("load-status").innerText=i.t;this._init(),a.emit(o.APP_BOOTED,{architect:this}),setTimeout(()=>document.getElementById("loading-screen").classList.add("hidden"),600)}_init(){this._applyTheme(localStorage.getItem(w.THEME)||"dark"),this._canvas.style.height=`${this.totalYears*this.yearHeight}px`,this._viewport.scrollTop=this.startY,document.addEventListener("visibilitychange",()=>{document.hidden&&this._saveState()}),window.addEventListener("beforeunload",()=>this._saveState()),setInterval(()=>this._saveState(),3e4),this.observer=new IntersectionObserver(t=>{t.forEach(e=>{var r;const i=e.target,s=parseInt(i.dataset.year||"0"),n=i.classList.contains("active");if(i.classList.toggle("active",e.isIntersecting),e.isIntersecting&&!n&&"vibrate"in navigator&&((r=navigator.vibrate)==null||r.call(navigator,8)),!e.isIntersecting){const h=Math.round(this._viewport.scrollTop/this.yearHeight),c=this._today.getFullYear()+(h-this.totalYears/2);Math.abs(s-c)>2&&(this._activeYears.delete(s),this.observer.unobserve(i),i.remove())}if(e.isIntersecting&&this._viewport.scrollTop<this._lastScrollPos){const h=i.querySelector(".grid-container");h&&i.classList.contains("is-scrolling")&&(h.scrollTop=h.scrollHeight)}}),this._lastScrollPos=this._viewport.scrollTop},{threshold:.05,rootMargin:"20% 0px"}),this._setupListeners(),this._cursorLoop(),this._render(),setTimeout(()=>this.jumpToToday(!0),150)}_setIonGlow(t){document.documentElement.style.setProperty("--ion-glow",t)}_lockInteractions(){this._isInteractingAllowed=!1,this._viewport.classList.add("is-locked"),this._setIonGlow("200px"),a.emit(o.AUDIO_SET_BUSY,!0)}_unlockInteractions(){setTimeout(()=>{this._isInteractingAllowed=!0,a.emit(o.AUDIO_SET_BUSY,!1),this._viewport.classList.remove("is-locked"),this._setIonGlow("700px")},400)}jumpToToday(t=!1){if(this._isWarping)return;const e=this._today.getFullYear(),i=(e-(this._today.getFullYear()-Math.floor(this.totalYears/2)))*this.yearHeight,s=this._today.getFullYear()+(Math.round(this._viewport.scrollTop/this.yearHeight)-this.totalYears/2),n=Math.abs(e-s);this._isWarping=!0,this._lockInteractions(),a.emit(o.NAV_WARP_START,{currentYear:s,targetYear:e,distance:n,isInitial:t}),this._ionDrive.classList.add("jumping");let r="",h=u.display.warpDuration;if(n>20){r="warping-far",a.emit(o.AUDIO_PLAY,{key:"jump",options:{volume:.8}}),h=1800;for(let c=0;c<15;c++)this._particles.spawn(this._current.x,this._current.y,!1)}else n>=2?(r="warping-near",a.emit(o.AUDIO_PLAY,{key:"warp",options:{volume:.5}}),h=1200):a.emit(o.AUDIO_PLAY,{key:"scroll"});r&&this._viewport.classList.add(r),this._viewport.style.scrollBehavior="smooth",this._viewport.scrollTo({top:i,behavior:"smooth"}),t||g(n>20?"Initiating Interstellar Jump Sequence":"Executing Local Warp Protocol"),setTimeout(()=>{this._viewport.classList.remove("warping-far","warping-near"),this._ionDrive.classList.remove("jumping");for(let l=0;l<3;l++)setTimeout(()=>{this._particles.spawn(this._current.x,this._current.y,!1)},l*50);const c=this._activeYears.get(e);if(c){const l=c.querySelector(".cell.today"),p=c.querySelector(".grid-container");l&&p&&p.scrollTo({top:l.offsetTop-window.innerHeight/3,behavior:"smooth"})}a.emit(o.AUDIO_PLAY,{key:"beep"}),this._isWarping=!1,a.emit(o.NAV_WARP_END,{targetYear:e,duration:h}),this._unlockInteractions()},h)}_setupListeners(){window.addEventListener("pointermove",e=>{this._mouse.x=e.clientX,this._mouse.y=e.clientY;const i=Math.sqrt(Math.pow(e.clientX-this._lastMouse.x,2)+Math.pow(e.clientY-this._lastMouse.y,2));i>u.physics.exhaustThreshold&&this._particles.spawn(e.clientX,e.clientY,!0),a.emit(o.AUDIO_INJECT_ENGINE_POWER,i),a.emit(o.INPUT_POINTER_MOVE,{x:e.clientX,y:e.clientY,velocity:i}),this._lastMouse={x:e.clientX,y:e.clientY},a.emit(o.AUDIO_RESET_IDLE_TIMER)},{passive:!0}),document.addEventListener("mouseover",e=>{if(!this._isInteractingAllowed||this._isWarping||this._isScrolling)return;const i=e.target.closest(".cell");if(i){const s=i.classList.contains("filler");this._ionDrive.classList.add("active"),this._setIonGlow(s?"200px":"900px"),a.emit(o.AUDIO_PLAY,{key:"hover",options:{volume:s?.04:.25,playbackRate:s?.5:1}}),a.emit(o.INPUT_HOVER,{filler:s})}},{passive:!0}),document.addEventListener("mouseout",e=>{e.target.closest(".cell")&&this._isInteractingAllowed&&(this._ionDrive.classList.remove("active"),this._setIonGlow("700px"))},{passive:!0});const t=M(()=>{this._isScrolling=!1,this._unlockInteractions(),a.emit(o.NAV_SCROLL_END,{top:this._viewport.scrollTop}),O(document.documentElement,{"--chroma-dist":0})},150);this._viewport.addEventListener("scroll",()=>{this._isScrolling||(this._lockInteractions(),a.emit(o.NAV_SCROLL_START,{top:this._viewport.scrollTop}),a.emit(o.AUDIO_PLAY,{key:"scroll"})),this._isScrolling=!0,this.ticking||(window.requestAnimationFrame(()=>{this._render(),this._handleParallax();const e=Math.abs(this._viewport.scrollTop-this._lastScrollPos);if(e>1){const i=Math.min(12,e/10);O(document.documentElement,{"--chroma-dist":i})}this._lastScrollPos=this._viewport.scrollTop,this.ticking=!1}),this.ticking=!0),t()},{passive:!0}),window.addEventListener("keydown",e=>{let i=e.key.toLowerCase();e.ctrlKey&&(i="ctrl+"+i);const s=A.shortcutMap[i];typeof s=="function"&&s(e,this)}),document.addEventListener("click",e=>{this._isInteractingAllowed&&(this._particles.spawn(e.clientX,e.clientY,!1),a.emit(o.AUDIO_PLAY,{key:"beep",options:{volume:.15}}),a.emit(o.INPUT_CLICK,{x:e.clientX,y:e.clientY}))}),window.addEventListener("resize",()=>{this.yearHeight=window.innerHeight,this._canvas.style.height=`${this.totalYears*this.yearHeight}px`,this._particles.resize&&this._particles.resize(),this._render()})}_cursorLoop(){this.animationsEnabled&&(window.matchMedia("(pointer: coarse)").matches||(this._current.x+=(this._mouse.x-this._current.x)*u.physics.cursorInertia,this._current.y+=(this._mouse.y-this._current.y)*u.physics.cursorInertia,document.documentElement.style.setProperty("--ion-x",String(this._current.x)),document.documentElement.style.setProperty("--ion-y",String(this._current.y)),a.emit(o.AUDIO_UPDATE_SPATIAL_POSITION,{x:this._current.x,y:this._current.y}),requestAnimationFrame(()=>this._cursorLoop())))}_handleParallax(){if(!this.animationsEnabled)return;const t=Math.round(this._viewport.scrollTop/this.yearHeight),e=this._today.getFullYear()+(t-this.totalYears/2),i=this._activeYears.get(e);if(i&&!this._isScrolling){const s=this._viewport.scrollTop%this.yearHeight-this.yearHeight/2,n=i.querySelector(".watermark-embedded");n&&(n.style.transform=`translate3d(0, ${s*.06}px, 0)`)}}_render(){if(!this.animationsEnabled)return;const t=Math.round(this._viewport.scrollTop/this.yearHeight),e=this._today.getFullYear()+(t-this.totalYears/2);for(let i=-1;i<=1;i++)this._drawYear(e+i,(t+i)*this.yearHeight)}_drawYear(t,e){if(this._activeYears.has(t))return;const i=document.createElement("section");i.className="year-block",i.style.top=`${e}px`,i.dataset.year=String(t);const s=new Date(t,0,1),n=t%4===0&&t%100!==0||t%400===0?366:365,r=window.innerWidth,h=window.innerHeight;let c=r>=600?Math.ceil(Math.ceil(Math.sqrt(373*(r/h)))/7)*7:7,l=this._isRandomMode?Math.floor(s.getTime()/864e5)%c:(s.getDay()+6)%7;const p=Math.ceil((n+l)/c),_=h/p<60;_&&i.classList.add("is-scrolling");const v=document.createElement("div");v.className="grid-container",v.style.overflowY=_?"auto":"hidden";const y=document.createElement("div");y.className="watermark-embedded",y.innerText=String(t),v.append(y);const E=document.createElement("div");E.className="grid-layer",E.style.gridTemplateColumns=`repeat(${c}, 1fr)`,E.style.gridTemplateRows=_?`repeat(${p}, minmax(60px, 1fr))`:`repeat(${p}, 1fr)`,E.style.height=_?"auto":"100%";const b=document.createDocumentFragment(),m=new Date(t,0,1-l);for(let T=0;T<c*p;T++){const f=m.getFullYear()===t,S=document.createElement("div");let x=f?"":m.getFullYear()<t?"filler-past":"filler-future";S.className=`cell ${f?"":"filler "+x} ${m.toDateString()===this._today.toDateString()&&f?"today":""} ${f&&m.getDate()===1?"month-start":""} ${f&&(m.getDay()===0||m.getDay()===6)?"weekend":""} ${f&&m.getDay()===1?"week-start":""}`,S.innerHTML=`<div class="cell-content"><span class="info-meta ${m.getDate()===1&&f?"top-label":""}">${f&&(m.getDate()===1||T===l)?u.temporal.monthsShort[m.getMonth()]:""}</span><span class="date-num">${m.getDate()}</span><span class="info-meta">${f?u.temporal.daysShort[m.getDay()]:""}</span></div>`,b.append(S),m.setDate(m.getDate()+1)}E.append(b),v.append(E),i.append(v),this._canvas.append(i),this._activeYears.set(t,i),this.observer.observe(i)}_setMode(t){this._isRandomMode!==t&&(this._isRandomMode=t,this._activeYears.forEach(e=>{this.observer.unobserve(e),e.remove()}),this._activeYears.clear(),this._render(),this._saveState(),a.emit(o.AUDIO_PLAY,{key:"beep"}),a.emit(o.NAV_MODE_CHANGED,{isRandomMode:t}),g(t?"Randomized Navigation Mode Activated":"Chronological Calendar Mode Activated"))}_applyTheme(t){document.documentElement.setAttribute("data-theme",t),document.documentElement.style.colorScheme=t}_toggleTheme(){const t=document.getElementById("theme-veil");t.classList.add("active"),setTimeout(()=>{const e=document.documentElement.getAttribute("data-theme")==="light"?"dark":"light";this._applyTheme(e),localStorage.setItem("theme",e),a.emit(o.UI_THEME_CHANGED,{theme:e}),this._saveState(),setTimeout(()=>t.classList.remove("active"),200)},400)}};A.shortcutMap={"ctrl+t":(t,e)=>{t.preventDefault(),a.emit(o.AUDIO_PLAY,{key:"theme"}),e._toggleTheme()},m:(t,e)=>{a.emit(o.AUDIO_TOGGLE_MASTER)},home:(t,e)=>{t.preventDefault(),e.jumpToToday()},r:(t,e)=>{e._setMode(!0)},c:(t,e)=>{e._setMode(!1)}};let I=A;a.on(o.APP_BOOTED,d=>{g("Expedition Navigation Systems Online",1500)});(function(){let t=!1;function e(i){t=!!i,a.emit(o.POWER_SAVING_CHANGED,{enabled:t})}window.enablePowerSavingMode=e,typeof document<"u"&&document.addEventListener("visibilitychange",()=>{e(document.hidden)}),typeof window<"u"&&(window.addEventListener("blur",()=>e(!0)),window.addEventListener("focus",()=>e(!1))),a.on(o.POWER_SAVING_CHANGED,({enabled:i})=>{a.emit(o.AUDIO_SET_ENABLED,!i),a.emit(o.ANIMATION_SET_ENABLED,!i),document.documentElement.classList.toggle("powersave",i),g(i?"Power Saving Mode Activated":"Power Saving Mode Disabled",1800)})})();window.addEventListener("DOMContentLoaded",()=>{new G,new I});
