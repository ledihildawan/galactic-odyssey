<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Telkomsel Story - The Perfect Masterpiece</title>
    <style>
      :root {
        --brand-red: #ee2d24;
        --brand-dark: #050505;
        --surface: #ffffff;
        --bg-gray: #f8f9fa;
        --text-main: #111111;
        --text-sub: #555555;
        --glass-bg: rgba(20, 20, 20, 0.6);
        --glass-border: rgba(255, 255, 255, 0.15);
        --ease-out: cubic-bezier(0.25, 1, 0.5, 1);
        --ease-spring: cubic-bezier(0.34, 1.5, 0.64, 1);
        --card-width: 420px;
        --fab-size: 44px;
        --frame-radius: 16px;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: transparent;
      }
      body {
        background: #0f0f11;
        font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
        overflow: hidden;
        color: var(--text-main);
      }

      .story-excerpt:focus-visible,
      button:focus-visible {
        outline: 2px solid var(--brand-red);
        outline-offset: 2px;
      }

      /* =========================================================
         LAYOUT UTAMA
         ========================================================= */
      .layout-wrapper {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100dvh;
        width: 100vw;
        touch-action: pan-y;
        opacity: 0;
        transition: opacity 0.5s var(--ease-out);
      }
      .layout-wrapper.is-ready {
        opacity: 1;
      }

      .desktop-slider {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100dvh;
        width: 100%;
        transition: padding 0.7s var(--ease-spring);
      }
      .story-group-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100dvh;
        width: 100%;
        transition: transform 0.6s var(--ease-spring);
      }

      .story-container {
        position: relative;
        height: 100dvh;
        width: 100%;
        max-width: calc(100dvh * 9 / 16);
        min-width: 320px;
        background: var(--brand-dark);
        overflow: hidden;
        z-index: 10;
        border-radius: var(--frame-radius);
        transition:
          border-radius 0.6s var(--ease-out),
          box-shadow 0.6s var(--ease-out);
        transform: translateZ(0);
      }

      /* Z-INDEX 1 - 10: BASE & AMBIENT LAYER */
      .ambient-layer {
        display: none;
        position: absolute;
        top: 5%;
        left: 0;
        right: 0;
        margin: 0 auto;
        width: 110%;
        height: 90%;
        z-index: 1;
        filter: blur(50px) saturate(150%);
        opacity: 0.4;
        pointer-events: none;
        transition: opacity 0.8s ease;
        transform: translate3d(0, 0, 0) scale(1.05);
        will-change: opacity;
        backface-visibility: hidden;
      }
      #ambientPlayer {
        width: 100%;
        height: 100%;
        border: none;
        opacity: 0;
        transition: opacity 1s var(--ease-out);
      }
      .story-container.is-focused .ambient-layer {
        opacity: 0.25;
      }

      .story-viewport {
        position: absolute;
        inset: 0;
        z-index: 10;
        background: transparent;
        overflow: hidden;
        border-radius: inherit;
        transition:
          filter 0.6s var(--ease-out),
          transform 0.6s var(--ease-out);
        will-change: filter, transform;
      }
      .story-video-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: var(--brand-dark);
      }
      .story-video-wrapper::after {
        content: '';
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: 5;
        background: linear-gradient(
          to bottom,
          rgba(0, 0, 0, 0.2) 0,
          rgba(0, 0, 0, 0) 20%,
          rgba(0, 0, 0, 0) 65%,
          rgba(0, 0, 0, 0.85) 100%
        );
        transition: opacity 0.4s var(--ease-out);
      }

      #youtubePlayer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
        pointer-events: none;
        object-fit: cover;
        opacity: 0;
        transition: opacity 0.8s var(--ease-out);
      }

      /* Z-INDEX 15: EFFECTS LAYER */
      #reaction-container {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 15;
        overflow: hidden;
        contain: strict;
      }
      .particle {
        position: absolute;
        top: -10%;
        left: var(--x);
        font-size: var(--size);
        opacity: 0;
        will-change: transform, opacity;
        animation: drop-physics var(--duration) ease-in forwards;
        animation-delay: var(--delay);
        filter: blur(var(--blur)) drop-shadow(0 2px 6px rgba(0, 0, 0, 0.4));
        z-index: var(--z);
      }
      @keyframes drop-physics {
        0% {
          transform: translate3d(0, 0, 0) rotate(0deg);
          opacity: 0;
        }
        10%,
        80% {
          opacity: 1;
        }
        100% {
          transform: translate3d(var(--drift), 120vh, 0) rotate(var(--rotation));
          opacity: 0;
        }
      }

      .story-center-play {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(1.5);
        font-size: 80px;
        z-index: 15;
        opacity: 0;
        pointer-events: none;
        transition:
          opacity 0.4s ease-out,
          transform 0.4s ease-out;
        filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.5));
        will-change: transform, opacity;
      }
      /* Class baru untuk Hold Indicator (Steady) dan Tap Indicator (Flashing) */
      .story-center-play.is-flashing,
      .story-center-play.is-steady {
        opacity: 0.9;
        transform: translate(-50%, -50%) scale(1);
        transition:
          opacity 0.1s ease-in,
          transform 0.2s var(--ease-spring);
      }

      /* Z-INDEX 20: INVISIBLE GESTURE UI LAYER */
      .story-gesture-layer {
        position: absolute;
        inset: 0;
        z-index: 20;
        display: flex;
        cursor: pointer;
        touch-action: none;
        -webkit-touch-callout: none;
        user-select: none;
      }
      .gesture-zone {
        height: 100%;
      }
      .gesture-zone--left {
        width: 30%;
      }
      .gesture-zone--center {
        width: 40%;
      }
      .gesture-zone--right {
        width: 30%;
      }

      /* =========================================================
         Z-INDEX 30: PROGRESS BAR
         ========================================================= */
      .story-progress-bar-wrapper {
        position: absolute;
        bottom: max(16px, env(safe-area-inset-bottom));
        left: 16px;
        right: 16px;
        height: 24px;
        z-index: 30;
        cursor: pointer;
        display: flex;
        align-items: center;
        opacity: 0;
        transition: opacity 0.8s var(--ease-out);
      }
      .story-progress-bar {
        width: 100%;
        height: 4px;
        background: rgba(255, 255, 255, 0.25);
        border-radius: 4px;
        overflow: hidden;
        transition: height 0.2s var(--ease-out);
      }
      .story-progress-bar-wrapper:hover .story-progress-bar {
        height: 8px;
      }
      .story-progress-bar__fill {
        height: 100%;
        background: rgba(255, 255, 255, 0.95);
        width: 100%;
        transform-origin: left;
        transform: scaleX(0);
        border-radius: 4px;
        box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
        will-change: transform;
      }

      /* =========================================================
         Z-INDEX 40: FLOATING UI (Tombol & Teks)
         ========================================================= */
      .story-top-actions {
        position: absolute;
        top: max(16px, env(safe-area-inset-top)); /* Dikembalikan ke atas (16px) */
        left: 16px;
        z-index: 40;
        display: flex;
        flex-direction: row;
        gap: 12px;
        opacity: 0;
        pointer-events: none;
        transform: translateY(-20px);
        transition:
          opacity 0.8s var(--ease-out),
          transform 0.8s var(--ease-spring);
      }

      .story-excerpt {
        position: absolute;
        bottom: max(48px, env(safe-area-inset-bottom));
        left: 20px;
        right: 20px;
        padding-right: 70px;
        z-index: 40;
        color: #fff;
        cursor: pointer;
        opacity: 0;
        pointer-events: none;
        transform: translateY(20px);
        transition:
          opacity 0.8s var(--ease-out),
          transform 0.8s var(--ease-spring);
        background: transparent;
        border: none;
        text-align: left;
        font-family: inherit;
        display: block;
      }
      .story-player-actions {
        position: absolute;
        bottom: max(48px, env(safe-area-inset-bottom));
        right: 16px;
        z-index: 40;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
        opacity: 0;
        pointer-events: none;
        transform: translateY(20px);
        transition:
          opacity 0.8s var(--ease-out),
          transform 0.8s var(--ease-spring);
      }

      .story-excerpt__badge {
        background: rgba(255, 255, 255, 0.15);
        color: #fff;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 0.5px solid var(--glass-border);
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        padding: 6px 12px;
        border-radius: 8px;
        display: inline-block;
        margin-bottom: 12px;
      }
      .story-excerpt__title {
        font-size: 20px;
        font-weight: 800;
        margin-bottom: 8px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.6);
        line-height: 1.2;
      }
      .story-excerpt__text {
        font-size: 14px;
        line-height: 1.5;
        opacity: 0.9;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-shadow: 0 1px 8px rgba(0, 0, 0, 0.6);
      }

      .player-fab {
        width: var(--fab-size);
        height: var(--fab-size);
        border-radius: 50%;
        background: var(--glass-bg);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid var(--glass-border);
        color: #fff;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        transition:
          background 0.3s,
          box-shadow 0.3s,
          opacity 0.3s,
          transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      .player-fab:active {
        background: rgba(255, 255, 255, 0.1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        transform: scale(0.9);
      }

      .reaction-wrapper {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .reaction-options {
        position: absolute;
        bottom: 100%;
        right: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        pointer-events: none;
        padding-bottom: 12px;
      }
      .reaction-wrapper.is-active .reaction-options {
        pointer-events: auto;
      }
      .reaction-option-btn {
        width: var(--fab-size);
        height: var(--fab-size);
        border-radius: 50%;
        background: var(--glass-bg);
        backdrop-filter: blur(16px);
        border: 1px solid var(--glass-border);
        color: #fff;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        opacity: 0;
        transform: translateY(20px) scale(0.6);
        transition: all 0.4s var(--ease-spring);
      }
      .reaction-option-btn:active {
        background: rgba(255, 255, 255, 0.1);
        transform: scale(0.85);
      }
      .reaction-wrapper.is-active .reaction-option-btn {
        opacity: 1;
        transform: translateY(0) scale(1);
        margin-bottom: 10px;
      }
      .reaction-wrapper.is-active .player-fab {
        background: rgba(255, 255, 255, 0.9);
        color: var(--brand-dark);
      }
      .reaction-option-btn:nth-child(1) {
        transition-delay: 0s;
      }
      .reaction-option-btn:nth-child(2) {
        transition-delay: 0.04s;
      }
      .reaction-option-btn:nth-child(3) {
        transition-delay: 0.08s;
      }
      .reaction-option-btn:nth-child(4) {
        transition-delay: 0.12s;
      }
      .reaction-wrapper.is-active .reaction-option-btn:nth-child(4) {
        transition-delay: 0s;
      }
      .reaction-wrapper.is-active .reaction-option-btn:nth-child(3) {
        transition-delay: 0.05s;
      }
      .reaction-wrapper.is-active .reaction-option-btn:nth-child(2) {
        transition-delay: 0.1s;
      }
      .reaction-wrapper.is-active .reaction-option-btn:nth-child(1) {
        transition-delay: 0.15s;
      }

      .layout-wrapper.is-ready .story-excerpt,
      .layout-wrapper.is-ready .story-player-actions,
      .layout-wrapper.is-ready .story-progress-bar-wrapper,
      .layout-wrapper.is-ready .story-top-actions {
        opacity: 1;
        pointer-events: auto;
        transform: translateY(0);
      }

      /* Z-INDEX 50+: LOADERS & EXTERNAL UI */
      .story-loader {
        position: absolute;
        inset: 0;
        z-index: 50;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--brand-dark);
        transition: opacity 0.4s var(--ease-out);
        pointer-events: none;
      }
      .story-loader__spinner {
        width: 42px;
        height: 42px;
        border: 3.5px solid rgba(255, 255, 255, 0.1);
        border-top-color: var(--brand-red);
        border-radius: 50%;
        animation: spin 1s cubic-bezier(0.5, 0, 0.5, 1) infinite;
      }
      .layout-wrapper.is-ready .story-loader {
        opacity: 0;
      }

      .desktop-controls-wrapper {
        position: fixed;
        right: 16px;
        top: 0;
        bottom: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        pointer-events: none;
        z-index: 50;
        opacity: 0;
        transition: opacity 0.8s var(--ease-out);
      }
      .layout-wrapper.is-ready .desktop-controls-wrapper {
        opacity: 1;
      }
      .desktop-controls-wrapper > * {
        pointer-events: auto;
      }

      .story-close-player {
        position: fixed;
        top: max(16px, env(safe-area-inset-top)); /* Dikembalikan ke atas */
        right: 16px;
      }
      .external-nav-group {
        display: none;
        flex-direction: column;
        gap: 12px;
      }
      .external-nav-btn {
        width: var(--fab-size);
        height: var(--fab-size);
        border-radius: 50%;
        background: var(--glass-bg);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid var(--glass-border);
        color: #fff;
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        transition:
          background 0.3s ease,
          transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275),
          opacity 0.3s ease;
      }
      .external-nav-btn:active:not(.is-disabled) {
        background: rgba(255, 255, 255, 0.1);
        transform: scale(0.9);
      }
      .external-nav-btn.is-disabled {
        opacity: 0.3;
        cursor: not-allowed;
        pointer-events: none;
      }

      /* LOGIKA CLEAN MODE */
      .layout-wrapper.is-clean-mode .reaction-wrapper,
      .layout-wrapper.is-clean-mode .share-fab,
      .layout-wrapper.is-clean-mode .story-excerpt,
      .layout-wrapper.is-clean-mode .story-top-actions {
        opacity: 0 !important;
        pointer-events: none !important;
        visibility: hidden !important;
      }
      .layout-wrapper.is-clean-mode .story-top-actions {
        transform: translateY(-20px) !important;
      }
      .layout-wrapper.is-clean-mode .story-video-wrapper::after {
        opacity: 0 !important;
        visibility: hidden !important;
      }
      .layout-wrapper.is-clean-mode #icon-enter-fs {
        display: none !important;
      }
      .layout-wrapper.is-clean-mode #icon-exit-fs {
        display: block !important;
      }
      @media (max-width: 767px) {
        .layout-wrapper.is-clean-mode .story-close-player {
          opacity: 0 !important;
          pointer-events: none !important;
          visibility: hidden !important;
        }
      }

      /* Z-INDEX 100+: MODALS & CARDS */
      .story-card {
        display: none;
        width: var(--card-width);
        height: auto;
        max-height: calc(100dvh - 80px);
        background: var(--surface);
        border-radius: var(--frame-radius);
        padding: 24px 0 0;
        z-index: 100;
        position: relative;
        flex-direction: column;
        overflow: hidden;
        box-shadow: 0 32px 72px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }
      .overlay-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
        opacity: 0;
        transition: opacity 0.5s;
        pointer-events: auto;
        touch-action: none;
      }
      .is-active .overlay-backdrop {
        opacity: 1;
      }

      .story-sheet {
        position: fixed;
        inset: 0;
        z-index: 100;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        visibility: hidden;
        pointer-events: none;
      }
      .story-sheet.is-active {
        visibility: visible;
      }
      .story-sheet__content {
        position: relative;
        background: var(--surface);
        border-radius: 28px 28px 0 0;
        width: 100%;
        padding: 12px 0 0;
        z-index: 101;
        transform: translateY(100%);
        pointer-events: auto;
        max-height: 88vh;
        height: auto;
        display: flex;
        flex-direction: column;
        transition: transform 0.6s var(--ease-spring);
        box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.2);
        will-change: transform;
      }
      .story-sheet.is-active .story-sheet__content {
        transform: translateY(0);
      }
      .story-sheet__content.is-dragging {
        transition: transform 0.1s ease-out;
      }
      .story-sheet__handle-wrapper {
        width: 100%;
        padding: 10px 0 24px;
        cursor: grab;
        display: flex;
        justify-content: center;
        flex-shrink: 0;
        touch-action: none;
      }
      .story-sheet__handle {
        width: 44px;
        height: 5px;
        background: #d1d1d6;
        border-radius: 10px;
      }

      .story-popup {
        position: fixed;
        inset: 0;
        z-index: 100;
        display: flex;
        justify-content: center;
        align-items: center;
        visibility: hidden;
        pointer-events: none;
      }
      .story-popup.is-active {
        visibility: visible;
      }
      .story-popup__content {
        position: relative;
        background: var(--surface);
        width: var(--card-width);
        padding: 24px 0;
        z-index: 101;
        opacity: 0;
        transform: translateY(40px);
        max-height: calc(100dvh - 64px);
        height: auto;
        border-radius: var(--frame-radius);
        transition:
          transform 0.6s var(--ease-spring),
          opacity 0.6s var(--ease-spring);
        pointer-events: auto;
        display: flex;
        flex-direction: column;
        box-shadow: 0 24px 64px rgba(0, 0, 0, 0.25);
      }
      .story-popup.is-active .story-popup__content {
        opacity: 1;
        transform: translateY(0);
      }

      .story-close-btn {
        position: absolute;
        top: 16px;
        right: 16px;
        width: 36px;
        height: 36px;
        border: none;
        background: var(--bg-gray);
        border-radius: 50%;
        font-size: 14px;
        font-weight: bold;
        color: var(--text-sub);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s;
        z-index: 30;
      }

      .story-dynamic-area,
      .story-view {
        display: flex;
        flex-direction: column;
        min-height: 0;
        flex: 1 1 auto;
      }
      .story-header {
        flex-shrink: 0;
        padding: 0 64px 0 28px;
        margin-bottom: 16px;
      }
      .story-view__title {
        font-size: 24px;
        font-weight: 800;
        color: var(--text-main);
        margin-bottom: 6px;
        line-height: 1.25;
      }
      .story-view__title:focus {
        outline: none;
      }
      .story-view__meta {
        font-size: 13px;
        font-weight: 500;
        color: #888;
        display: block;
      }
      .story-body {
        flex: 1 1 auto;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        padding: 0 28px 32px;
        min-height: 0;
        overscroll-behavior-y: contain;
      }
      .story-body::-webkit-scrollbar {
        width: 5px;
      }
      .story-body::-webkit-scrollbar-thumb {
        background: #d1d1d6;
        border-radius: 10px;
      }
      .story-body::-webkit-scrollbar-track {
        background: transparent;
        margin: 8px 0;
      }
      .story-body__cms-content {
        font-size: 15px;
        color: var(--text-sub);
        line-height: 1.6;
      }
      .story-body__cms-content p {
        margin-bottom: 16px;
      }

      @media (hover: hover) and (pointer: fine) {
        .layout-wrapper.is-ready .story-excerpt:hover {
          opacity: 0.9;
        }
        .player-fab:hover {
          background: rgba(255, 255, 255, 0.25);
          box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        .reaction-option-btn:hover {
          background: rgba(255, 255, 255, 0.25);
        }
        .story-close-btn:hover {
          background: #e9ecef;
          color: var(--text-main);
        }
        .external-nav-btn:hover:not(.is-disabled) {
          background: rgba(255, 255, 255, 0.25);
          box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
      }

      /* RESPONSIVE BREAKPOINTS */
      @media (max-width: 767px) {
        .story-container,
        .story-viewport {
          border-radius: 0 !important;
        }
        .story-popup {
          display: none !important;
        }
        .story-group-wrapper {
          width: 100%;
        }
        .story-header {
          padding: 0 28px;
        }
        .layout-wrapper.is-ui-open .story-viewport {
          filter: blur(12px) brightness(0.5);
          transform: scale(0.97);
          border-radius: var(--frame-radius) !important;
        }
        .layout-wrapper.is-ui-open .story-close-player,
        .layout-wrapper.is-ui-open .story-excerpt,
        .layout-wrapper.is-ui-open .story-player-actions,
        .layout-wrapper.is-ui-open .story-top-actions {
          opacity: 0;
          pointer-events: none;
        }
      }

      @media (min-width: 768px) and (max-width: 1365px) {
        .story-sheet {
          display: none !important;
        }
        .ambient-layer {
          display: block;
        }
        .story-group-wrapper {
          height: calc(100dvh - 64px);
          width: auto;
        }
        .story-container {
          width: auto;
          height: 100%;
          aspect-ratio: 9/16;
          overflow: visible;
          box-shadow: 0 24px 64px rgba(0, 0, 0, 0.4);
        }
        .desktop-controls-wrapper {
          right: 32px;
        }
        .external-nav-group {
          display: flex;
          margin-top: auto;
          margin-bottom: auto;
        }
        .story-close-player {
          position: relative;
          top: max(24px, env(safe-area-inset-top));
          right: auto;
        }
        .layout-wrapper.is-ui-open .desktop-controls-wrapper {
          opacity: 0;
          pointer-events: none;
        }
        .layout-wrapper.is-ui-open .story-viewport {
          filter: blur(12px) brightness(0.6);
          transform: scale(0.97);
        }
        .layout-wrapper.is-ui-open .story-excerpt,
        .layout-wrapper.is-ui-open .story-player-actions,
        .layout-wrapper.is-ui-open .story-top-actions {
          opacity: 0;
          pointer-events: none;
        }
      }

      @media (min-width: 1366px) {
        .story-popup,
        .story-sheet {
          display: none !important;
        }
        .ambient-layer {
          display: block;
          opacity: 0.6;
        }
        .story-group-wrapper {
          width: max-content;
          height: calc(100dvh - 80px);
          position: relative;
          transition: transform 0.6s var(--ease-spring);
          margin: 0 auto;
        }
        .story-container {
          width: auto;
          height: 100%;
          aspect-ratio: 9/16;
          overflow: visible;
          box-shadow: 0 24px 64px rgba(0, 0, 0, 0.4);
          z-index: 10;
        }
        .layout-wrapper.is-ui-open .story-group-wrapper {
          transform: translateX(calc((var(--card-width) + 16px) / -2));
        }
        .story-card {
          display: flex;
          position: fixed;
          right: -500px;
          top: 50%;
          transform: translateY(-50%);
          margin: 0;
          opacity: 0;
          pointer-events: none;
          transition: all 0.6s var(--ease-spring);
          z-index: 100;
        }
        .layout-wrapper.is-ui-open .story-card {
          opacity: 1;
          pointer-events: auto;
          right: 100px;
        }
        .desktop-controls-wrapper {
          right: 40px;
        }
        .external-nav-group {
          display: flex;
          margin-top: auto;
          margin-bottom: auto;
        }
        .story-close-player {
          position: relative;
          top: max(32px, env(safe-area-inset-top));
          right: auto;
        }
        .layout-wrapper.is-ui-open .desktop-controls-wrapper {
          opacity: 1;
          pointer-events: auto;
        }
        .layout-wrapper.is-ui-open .story-excerpt {
          opacity: 0;
          pointer-events: none;
        }
        .layout-wrapper.is-ui-open .story-player-actions,
        .layout-wrapper.is-ui-open .story-top-actions {
          opacity: 1;
          pointer-events: auto;
        }
      }
    </style>
  </head>
  <body>
    <div class="layout-wrapper" id="layoutWrapper" tabindex="-1">
      <div class="desktop-slider">
        <div class="story-group-wrapper" id="storyGroupWrapper">
          <div class="story-container" id="storyContainer">
            <div class="ambient-layer">
              <div id="ambientPlayer"></div>
            </div>
            <div class="story-viewport">
              <div class="story-loader">
                <div class="story-loader__spinner"></div>
              </div>

              <div class="story-video-wrapper">
                <div id="youtubePlayer"></div>
              </div>

              <div id="reaction-container"></div>
              <div class="story-center-play" id="centerPlayIndicator" aria-hidden="true">‚ñ∂Ô∏è</div>

              <div class="story-gesture-layer" id="storyGestureLayer">
                <div class="gesture-zone gesture-zone--left" data-action="rewind"></div>
                <div class="gesture-zone gesture-zone--center" data-action="playpause"></div>
                <div class="gesture-zone gesture-zone--right" data-action="forward"></div>
              </div>

              <div class="story-progress-bar-wrapper" id="storyProgressBarWrapper" aria-label="Progress Video">
                <div class="story-progress-bar">
                  <div class="story-progress-bar__fill" id="storyProgressFill"></div>
                </div>
              </div>

              <div class="story-top-actions">
                <button class="player-fab" id="btnPlayPause" aria-label="Pause Video">‚è∏Ô∏è</button>
                <button class="player-fab" id="btnMute" aria-label="Mute Audio">üîá</button>
              </div>

              <button class="story-excerpt" id="btnOpenContext" aria-label="Buka Detail Video">
                <span class="story-excerpt__badge">Kategori</span>
                <h2 class="story-excerpt__title">Judul Video</h2>
                <div class="story-excerpt__text">Deskripsi singkat video...</div>
              </button>

              <div class="story-player-actions">
                <div class="reaction-wrapper" id="reactionWrapper">
                  <div class="reaction-options">
                    <button class="reaction-option-btn" aria-label="Beri reaksi Hati" data-reaction="‚ù§Ô∏è">‚ù§Ô∏è</button>
                    <button class="reaction-option-btn" aria-label="Beri reaksi Api" data-reaction="üî•">üî•</button>
                    <button class="reaction-option-btn" aria-label="Beri reaksi Tertawa" data-reaction="ü§£">ü§£</button>
                    <button class="reaction-option-btn" aria-label="Beri reaksi Tepuk Tangan" data-reaction="üëèüèª">
                      üëèüèª
                    </button>
                    <button class="reaction-option-btn" aria-label="Beri reaksi Menangis" data-reaction="üò≠">üò≠</button>
                  </div>
                  <button class="player-fab" id="btnToggleReaction" aria-label="Pilih Reaksi" aria-expanded="false">
                    ü§ç
                  </button>
                </div>
                <button class="player-fab share-fab" id="btnShare" aria-label="Bagikan Tautan">üîó</button>
                <button class="player-fab fullscreen-fab" id="btnCleanMode" aria-label="Mode Bersih">
                  <span id="icon-enter-fs">üî≤</span><span id="icon-exit-fs" style="display: none">‚úñÔ∏è</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="story-card" id="storyCardDashboard">
          <button class="story-close-btn" aria-label="Tutup Detail">‚úñÔ∏è</button>
          <div class="story-dynamic-area"></div>
        </div>

        <div class="desktop-controls-wrapper">
          <button class="player-fab story-close-player" id="btnStoryClosePlayer" aria-label="Tutup Story">‚úñÔ∏è</button>
          <div class="external-nav-group">
            <button id="btnPrevStory" class="external-nav-btn" aria-label="Video Sebelumnya">üîº</button>
            <button id="btnNextStory" class="external-nav-btn" aria-label="Video Selanjutnya">üîΩ</button>
          </div>
        </div>
      </div>

      <div class="story-sheet" id="storySheet" aria-modal="true" role="dialog">
        <div class="story-sheet__backdrop overlay-backdrop"></div>
        <div class="story-sheet__content">
          <div class="story-sheet__handle-wrapper" id="storySheetHandle">
            <div class="story-sheet__handle"></div>
          </div>
          <div class="story-dynamic-area"></div>
        </div>
      </div>

      <div class="story-popup" id="storyPopup" aria-modal="true" role="dialog">
        <div class="story-popup__backdrop overlay-backdrop"></div>
        <div class="story-popup__content">
          <button class="story-close-btn" aria-label="Tutup Detail">‚úñÔ∏è</button>
          <div class="story-dynamic-area"></div>
        </div>
      </div>
    </div>

    <template id="storyContentTemplate">
      <div class="story-view is-active">
        <div class="story-header">
          <h3 class="story-view__title" tabindex="-1">Judul</h3>
          <span class="story-view__meta" id="storyMeta">Informasi ‚Ä¢ Meta</span>
        </div>
        <div class="story-body" tabindex="0">
          <div class="story-body__cms-content"></div>
        </div>
      </div>
    </template>

    <script>
      let player, ambientPlayer;
      let currentVideoIndex = 0;

      const videoPlaylist = [
        {
          id: 'lxSM-MYJsA8',
          badge: 'Match Highlight',
          title: 'Highlight Lengkap Gol Liga Champions Matchday 7! üî•',
          meta: 'UEFA Champions League ‚Ä¢ 2 Jam yang lalu',
          excerpt:
            'Semua gol dari Matchday ke-7 Liga Champions UEFA! Laga penuh aksi, kejutan tak terduga, dan gol-gol spektakuler.',
          content:
            '<p>Saksikan cuplikan lengkap seluruh gol dari ajang UEFA Champions League Matchday ke-7! Pekan ini menghadirkan laga penuh aksi dan kejutan tak terduga, salah satunya saat Bod√∏/Glimt secara dramatis menumbangkan Manchester City dengan skor 3-1.</p><p>Di laga lain, Arsenal sukses keluar sebagai pemenang dalam duel sengit kontra finalis musim lalu, Inter Milan. Sementara itu, Real Madrid kembali menunjukkan kelasnya dengan melumat AS Monaco 6-1 di hadapan publik sendiri.</p><p>Gol mana yang menjadi favoritmu di pekan ini? Persaingan menuju fase gugur <strong>semakin memanas!</strong></p>',
        },
        {
          id: 'VsVzlXU3u9k',
          badge: 'Tips & Trik',
          title: 'Trik Ampuh Meningkatkan Skill Dribbling Sepak Bola ‚öΩ',
          meta: 'Football Skills ‚Ä¢ 5 Jam yang lalu',
          excerpt:
            'Panduan latihan penguasaan bola jarak dekat, kecepatan, dan kelincahan berbelok untuk melewati bek lawan dengan mudah.',
          content:
            '<p>Latihan ini berfokus pada penguasaan <i>close control</i>, kecepatan menggiring bola, dan kelincahan berbelok. Mulailah dengan berlatih dribbling menggunakan sisi dalam dan luar kaki melewati rintangan (<i>cones</i>). Latihan dasar ini sangat penting agar kamu terbiasa menembus rapatnya barisan pertahanan lawan.</p><p>Setelah itu, tingkatkan intensitas dengan melakukan <i>zigzag turns</i> secara cepat dan tajam. Ingat, sentuhan pertama (<i>first touch</i>) yang sempurna akan memberimu waktu ekstra untuk mengambil keputusan krusial sebelum melepaskan tembakan mematikan (<i>finishing</i>) ke gawang lawan.</p>',
        },
        {
          id: 'jqbr2VED--0',
          badge: 'Update Transfer',
          title: 'Update Bursa Transfer: Manuver Mengejutkan Arsenal & Liverpool üí∏',
          meta: 'Transfer News ‚Ä¢ 1 Hari yang lalu',
          excerpt:
            'Arsenal incar Julian Alvarez, Liverpool bahas potensi penjualan Andy Robertson, serta update "Here We Go" terbaru.',
          content:
            '<p>Bursa transfer musim ini kembali memanas! Kabar mengejutkan datang dari kubu Arsenal yang dilaporkan tengah serius membidik <strong>Julian Alvarez</strong> guna mempertajam lini serang mereka.</p><p>Di tempat lain, Liverpool dikabarkan sedang melakukan pembicaraan intensif terkait potensi penjualan bek sayap andalan mereka, Andy Robertson. Tak ketinggalan, ada konfirmasi <i>"Here We Go"</i> terbaru dari jurnalis pakar transfer Fabrizio Romano mengenai pergerakan taktis Aston Villa. Efek domino dari rentetan transfer ini diprediksi akan segera mengubah peta kekuatan tim-tim elite Eropa!</p>',
        },
      ];

      const updateVideoUI = () => {
        const data = videoPlaylist[currentVideoIndex];
        const progressFill = document.getElementById('storyProgressFill');
        if (progressFill) progressFill.style.transform = 'scaleX(0)';

        document.querySelector('.story-excerpt__badge').innerText = data.badge;
        document.querySelector('.story-excerpt__title').innerText = data.title;
        document.querySelector('.story-excerpt__text').innerText = data.excerpt;

        document.querySelectorAll('.story-view__title').forEach((el) => (el.innerText = data.title));
        document.querySelectorAll('.story-view__meta').forEach((el) => (el.innerText = data.meta));
        document.querySelectorAll('.story-body__cms-content').forEach((el) => (el.innerHTML = data.content));

        if (player && typeof player.loadVideoById === 'function') player.loadVideoById(data.id);
        if (ambientPlayer && typeof ambientPlayer.loadVideoById === 'function') ambientPlayer.loadVideoById(data.id);

        StoryManager.startProgressBar();
        StoryManager.checkNavState();
      };

      window.StoryManager = (() => {
        const state = {
          isOpen: false,
          startY: 0,
          currentY: 0,
          isDragging: false,
          animFrameId: null,
          isAnimating: false,
        };

        const domRefs = {
          layoutWrapper: document.getElementById('layoutWrapper'),
          storyViewport: document.querySelector('.story-viewport'),
          progressBarWrapper: document.getElementById('storyProgressBarWrapper'),
          progressFill: document.getElementById('storyProgressFill'),
          mobileSheet: document.getElementById('storySheet'),
          mobileHandle: document.getElementById('storySheetHandle'),
          tabletPopup: document.getElementById('storyPopup'),
          dashboardCard: document.getElementById('storyCardDashboard'),
          contentTemplate: document.getElementById('storyContentTemplate'),
          reactionWrapper: document.getElementById('reactionWrapper'),
          btnPlayPause: document.getElementById('btnPlayPause'),
          btnMute: document.getElementById('btnMute'),
          iconEnter: document.getElementById('icon-enter-fs'),
          iconExit: document.getElementById('icon-exit-fs'),
          reactionContainer: document.getElementById('reaction-container'),
          centerPlayIndicator: document.getElementById('centerPlayIndicator'),
          btnPrevStory: document.getElementById('btnPrevStory'),
          btnNextStory: document.getElementById('btnNextStory'),
          storyGestureLayer: document.getElementById('storyGestureLayer'),
          btnToggleReaction: document.getElementById('btnToggleReaction'),
          btnOpenContext: document.getElementById('btnOpenContext'),
        };

        const getActiveContext = () => {
          const w = window.innerWidth;
          if (w >= 1366) return domRefs.dashboardCard;
          return w >= 768 ? domRefs.tabletPopup : domRefs.mobileSheet;
        };

        const injectTemplate = (el) => {
          const target = el.querySelector('.story-dynamic-area');
          if (target && target.innerHTML.trim() === '') {
            target.appendChild(domRefs.contentTemplate.content.cloneNode(true));
          }
        };
        [domRefs.mobileSheet, domRefs.tabletPopup, domRefs.dashboardCard].forEach(injectTemplate);

        let lastSyncCheck = 0;
        const loopProgress = () => {
          if (!state.isOpen && player && player.getPlayerState() === YT.PlayerState.PLAYING) {
            const duration = player.getDuration();
            const currentTime = player.getCurrentTime();
            if (duration > 0) {
              const progress = currentTime / duration;
              domRefs.progressFill.style.transform = `scaleX(${progress})`;
            }
            if (ambientPlayer && typeof ambientPlayer.getCurrentTime === 'function') {
              const now = performance.now();
              if (now - lastSyncCheck > 1000) {
                const ambientTime = ambientPlayer.getCurrentTime();
                if (Math.abs(currentTime - ambientTime) > 0.4) ambientPlayer.seekTo(currentTime, true);
                lastSyncCheck = now;
              }
            }
            state.animFrameId = requestAnimationFrame(loopProgress);
          } else {
            state.animFrameId = null;
          }
        };

        const startProgressBar = () => {
          if (state.animFrameId) cancelAnimationFrame(state.animFrameId);
          domRefs.progressFill.style.transform = 'scaleX(0)';
          state.animFrameId = requestAnimationFrame(loopProgress);
        };
        const stopProgressBar = () => {
          if (state.animFrameId) cancelAnimationFrame(state.animFrameId);
        };

        let flashTimeout;
        const flashIcon = (iconStr) => {
          const iconEl = domRefs.centerPlayIndicator;
          if (!iconEl) return;
          iconEl.innerText = iconStr;
          iconEl.classList.remove('is-flashing', 'is-steady');
          void iconEl.offsetWidth;
          iconEl.classList.add('is-flashing');
          clearTimeout(flashTimeout);
          flashTimeout = setTimeout(() => {
            iconEl.classList.remove('is-flashing');
          }, 500);
        };

        const showSteadyIcon = (iconStr) => {
          const iconEl = domRefs.centerPlayIndicator;
          if (!iconEl) return;
          clearTimeout(flashTimeout);
          iconEl.innerText = iconStr;
          iconEl.classList.remove('is-flashing');
          iconEl.classList.add('is-steady');
        };

        const hideSteadyIcon = () => {
          const iconEl = domRefs.centerPlayIndicator;
          if (!iconEl) return;
          iconEl.classList.remove('is-steady');
        };

        const checkNavState = () => {
          if (domRefs.btnPrevStory) domRefs.btnPrevStory.classList.toggle('is-disabled', currentVideoIndex === 0);
          if (domRefs.btnNextStory)
            domRefs.btnNextStory.classList.toggle('is-disabled', currentVideoIndex === videoPlaylist.length - 1);
        };

        const resetVideoState = () => {
          if (state.isOpen) closeContext();
          closeReactionMenu();
          domRefs.reactionContainer.innerHTML = '';
          domRefs.layoutWrapper.classList.remove('is-clean-mode');
        };

        const seekVideo = (offset) => {
          if (!player || typeof player.getCurrentTime !== 'function') return;
          const duration = player.getDuration();
          if (duration === 0) return;
          const newTime = Math.max(0, Math.min(player.getCurrentTime() + offset, duration));
          player.seekTo(newTime, true);
          if (ambientPlayer && typeof ambientPlayer.seekTo === 'function') ambientPlayer.seekTo(newTime, true);
          domRefs.progressFill.style.transform = `scaleX(${newTime / duration})`;
        };

        const slideTransition = (direction, callback) => {
          const viewport = domRefs.storyViewport;
          if (!viewport) return callback();
          state.isAnimating = true;

          const outTransform = direction === 'next' ? 'translateY(-100%) scale(0.95)' : 'translateY(100%) scale(0.95)';
          const inTransform = direction === 'next' ? 'translateY(100%) scale(0.95)' : 'translateY(-100%) scale(0.95)';

          viewport.style.transition = 'transform 0.35s cubic-bezier(0.32, 0.72, 0, 1), opacity 0.35s ease';
          viewport.style.transform = outTransform;
          viewport.style.opacity = '0';

          setTimeout(() => {
            callback();
            viewport.style.transition = 'none';
            viewport.style.transform = inTransform;
            void viewport.offsetHeight;
            viewport.style.transition = 'transform 0.45s cubic-bezier(0.34, 1.5, 0.64, 1), opacity 0.4s ease';
            viewport.style.transform = 'translateY(0) scale(1)';
            viewport.style.opacity = '1';

            setTimeout(() => {
              viewport.style.transition = '';
              viewport.style.transform = '';
              viewport.style.opacity = '';
              state.isAnimating = false;
            }, 450);
          }, 350);
        };

        const nextVideo = (e) => {
          if (e) e.stopPropagation();
          if (state.isAnimating) return;
          if (currentVideoIndex < videoPlaylist.length - 1) {
            resetVideoState();
            slideTransition('next', () => {
              currentVideoIndex++;
              updateVideoUI();
            });
          }
        };

        const prevVideo = (e) => {
          if (e) e.stopPropagation();
          if (state.isAnimating) return;
          if (currentVideoIndex > 0) {
            resetVideoState();
            slideTransition('prev', () => {
              currentVideoIndex--;
              updateVideoUI();
            });
          }
        };

        const closeStory = (e) => {
          if (e) e.stopPropagation();
          if (player && typeof player.pauseVideo === 'function') player.pauseVideo();
          if (ambientPlayer && typeof ambientPlayer.pauseVideo === 'function') ambientPlayer.pauseVideo();
          domRefs.layoutWrapper.style.opacity = '0';
          setTimeout(() => {
            domRefs.layoutWrapper.style.display = 'none';
          }, 500);
        };

        const togglePlayPause = () => {
          if (!player || typeof player.getPlayerState !== 'function') return;
          if (player.getPlayerState() === YT.PlayerState.PLAYING) {
            player.pauseVideo();
            if (ambientPlayer && typeof ambientPlayer.pauseVideo === 'function') ambientPlayer.pauseVideo();
            flashIcon('‚è∏Ô∏è');
          } else {
            player.playVideo();
            if (ambientPlayer && typeof ambientPlayer.seekTo === 'function') {
              ambientPlayer.seekTo(player.getCurrentTime(), true);
              ambientPlayer.playVideo();
            }
            flashIcon('‚ñ∂Ô∏è');
          }
        };

        const toggleMute = (e) => {
          if (e) e.stopPropagation();
          if (!player || typeof player.isMuted !== 'function') return;
          if (player.isMuted()) {
            player.unMute();
            domRefs.btnMute.innerText = 'üîä';
          } else {
            player.mute();
            domRefs.btnMute.innerText = 'üîá';
          }
        };

        const openContext = () => {
          const ctx = getActiveContext();
          if (!ctx) return;
          domRefs.layoutWrapper.classList.remove('is-clean-mode');
          domRefs.iconEnter.style.display = 'block';
          domRefs.iconExit.style.display = 'none';
          state.isOpen = true;
          domRefs.layoutWrapper.classList.add('is-ui-open');
          ctx.classList.add('is-active');

          if (window.innerWidth < 1366) {
            if (player && typeof player.pauseVideo === 'function') player.pauseVideo();
            if (ambientPlayer && typeof ambientPlayer.pauseVideo === 'function') ambientPlayer.pauseVideo();
          }
          closeReactionMenu();
          setTimeout(() => {
            const titleEl = ctx.querySelector('.story-view__title');
            if (titleEl) titleEl.focus();
          }, 100);
        };

        const closeContext = () => {
          if (!state.isOpen) return;
          state.isOpen = false;
          domRefs.layoutWrapper.classList.remove('is-ui-open');
          domRefs.mobileSheet.classList.remove('is-active');
          domRefs.tabletPopup.classList.remove('is-active');
          domRefs.dashboardCard.classList.remove('is-active');
          domRefs.mobileSheet.querySelector('.story-sheet__content').style.transform = '';

          if (window.innerWidth < 1366) {
            if (player && typeof player.playVideo === 'function') player.playVideo();
            if (ambientPlayer && typeof ambientPlayer.playVideo === 'function') ambientPlayer.playVideo();
          }
          domRefs.btnOpenContext.focus();
        };

        const toggleReactionMenu = (e) => {
          if (e) e.stopPropagation();
          if (domRefs.reactionWrapper) {
            const isActive = domRefs.reactionWrapper.classList.toggle('is-active');
            if (domRefs.btnToggleReaction) domRefs.btnToggleReaction.setAttribute('aria-expanded', isActive);
          }
        };

        const closeReactionMenu = () => {
          if (domRefs.reactionWrapper) {
            domRefs.reactionWrapper.classList.remove('is-active');
            if (domRefs.btnToggleReaction) domRefs.btnToggleReaction.setAttribute('aria-expanded', 'false');
          }
        };

        const toggleCleanMode = (e) => {
          if (e) {
            e.preventDefault();
            e.stopPropagation();
          }
          closeReactionMenu();
          domRefs.layoutWrapper.classList.toggle('is-clean-mode');
        };

        const nativeShare = async () => {
          const data = {
            title: videoPlaylist[currentVideoIndex].title,
            url: `https://www.youtube.com/watch?v=${videoPlaylist[currentVideoIndex].id}`,
          };
          try {
            if (navigator.share) await navigator.share(data);
            else {
              navigator.clipboard.writeText(data.url);
              alert('Tautan berhasil disalin!');
            }
          } catch (e) {}
        };

        const triggerReaction = (char) => {
          const fragment = document.createDocumentFragment();
          for (let i = 0; i < 35; i++) {
            const el = document.createElement('div');
            el.className = 'particle';
            el.innerText = char;
            const depth = Math.random();
            el.style.cssText = `--x:${Math.random() * 100}%;--size:${depth * 1.2 + 1.2}rem;--blur:${depth < 0.2 ? '2px' : '0px'};--z:${depth > 0.5 ? 20 : 1};--duration:${3500 - depth * 1500}ms;--delay:${Math.random() * 600}ms;--rotation:${(Math.random() - 0.5) * 720}deg;--drift:${(Math.random() - 0.5) * 120}px;`;
            el.onanimationend = () => el.remove();
            fragment.appendChild(el);
          }
          domRefs.reactionContainer.appendChild(fragment);
          if (navigator.vibrate) navigator.vibrate(40);
        };

        const react = (emoji, e) => {
          if (e && typeof e.stopPropagation === 'function') e.stopPropagation();
          triggerReaction(emoji);
          const mainBtn = domRefs.reactionWrapper.querySelector('.player-fab');
          if (mainBtn) {
            mainBtn.innerText = emoji;
            setTimeout(() => (mainBtn.innerText = 'ü§ç'), 1500);
          }
          closeReactionMenu();
        };

        // --- GESTURE PROGRESS BAR (KLIK & SCRUB) ---
        const initProgressBarGestures = () => {
          let isScrubbing = false;
          let wasPlaying = false;

          const updateSeek = (clientX) => {
            if (!player || typeof player.getDuration !== 'function') return;
            const rect = domRefs.progressBarWrapper.getBoundingClientRect();
            const clickX = clientX - rect.left;
            const percentage = Math.max(0, Math.min(1, clickX / rect.width));

            domRefs.progressFill.style.transform = `scaleX(${percentage})`;
            const duration = player.getDuration();
            const newTime = duration * percentage;
            player.seekTo(newTime, true);
            if (ambientPlayer && typeof ambientPlayer.seekTo === 'function') ambientPlayer.seekTo(newTime, true);
          };

          const startScrub = (e) => {
            e.stopPropagation();
            isScrubbing = true;
            if (player && player.getPlayerState() === YT.PlayerState.PLAYING) {
              wasPlaying = true;
              player.pauseVideo();
              if (ambientPlayer) ambientPlayer.pauseVideo();
            } else {
              wasPlaying = false;
            }
            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            updateSeek(clientX);
          };

          const moveScrub = (e) => {
            if (!isScrubbing) return;
            if (e.cancelable) e.preventDefault();
            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            updateSeek(clientX);
          };

          const stopScrub = () => {
            if (!isScrubbing) return;
            isScrubbing = false;
            if (wasPlaying && player) {
              player.playVideo();
              if (ambientPlayer) ambientPlayer.playVideo();
            }
          };

          const wrapper = domRefs.progressBarWrapper;
          wrapper.addEventListener('mousedown', startScrub);
          wrapper.addEventListener('touchstart', startScrub, { passive: true });
          window.addEventListener('mousemove', moveScrub);
          window.addEventListener('touchmove', moveScrub, { passive: false });
          window.addEventListener('mouseup', stopScrub);
          window.addEventListener('touchend', stopScrub);
        };

        // --- INVISIBLE GESTURE UI LAYER LOGIC ---
        const initGestures = () => {
          let startX = 0,
            startY = 0;
          let lastTapTime = 0;
          let clickTimer = null,
            longPressTimer = null;
          let isLongPressActive = false,
            isSwiping = false;
          let holdAction = null; // Menyimpan aksi area mana yang sedang di-hold

          const layer = domRefs.storyGestureLayer;

          layer.addEventListener('contextmenu', (e) => e.preventDefault());

          layer.addEventListener('pointerdown', (e) => {
            if (state.isAnimating) return;
            if (e.pointerType === 'mouse' && e.button !== 0) return;

            startX = e.clientX;
            startY = e.clientY;
            isLongPressActive = false;
            isSwiping = false;
            holdAction = e.target.getAttribute('data-action');

            longPressTimer = setTimeout(() => {
              isLongPressActive = true;

              // LOGIKA TAHAN LAYAR (LONG PRESS) DIBAGI 3 ZONA
              if (holdAction === 'playpause') {
                // Center Hold = Clean Mode & Pause
                domRefs.layoutWrapper.classList.add('is-clean-mode');
                if (player && player.getPlayerState() === YT.PlayerState.PLAYING) player.pauseVideo();
              } else if (holdAction === 'forward') {
                // Right Hold = Fast Forward 2x Speed
                if (player && typeof player.setPlaybackRate === 'function') {
                  player.setPlaybackRate(2);
                  if (ambientPlayer) ambientPlayer.setPlaybackRate(2);
                  showSteadyIcon('‚è© 2x');
                }
              } else if (holdAction === 'rewind') {
                // Left Hold = Slow Motion 0.5x Speed
                if (player && typeof player.setPlaybackRate === 'function') {
                  player.setPlaybackRate(0.5);
                  if (ambientPlayer) ambientPlayer.setPlaybackRate(0.5);
                  showSteadyIcon('‚è™ 0.5x');
                }
              }
            }, 400);
          });

          layer.addEventListener('pointermove', (e) => {
            if (state.isAnimating || !startX) return;
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;

            if (Math.abs(dx) > 10 || Math.abs(dy) > 10) {
              clearTimeout(longPressTimer);
              isSwiping = true;
            }
          });

          const handlePointerUp = (e) => {
            if (state.isAnimating || !startX) return;
            clearTimeout(longPressTimer);

            const dy = e.clientY - startY;
            startX = 0;

            if (isLongPressActive) {
              // RESTORE STATE SETELAH JARI DIANGKAT
              if (holdAction === 'playpause') {
                domRefs.layoutWrapper.classList.remove('is-clean-mode');
                if (player && typeof player.playVideo === 'function') player.playVideo();
              } else {
                if (player && typeof player.setPlaybackRate === 'function') {
                  player.setPlaybackRate(1); // Normal speed
                  if (ambientPlayer) ambientPlayer.setPlaybackRate(1);
                }
                hideSteadyIcon();
              }
              return; // Hentikan di sini agar tidak terbaca sebagai klik
            }

            if (isSwiping && Math.abs(dy) > 50) {
              if (dy > 0) prevVideo();
              else nextVideo();
              return;
            }

            if (!isSwiping) {
              const action = e.target.getAttribute('data-action');

              // SINGLE TAP Kiri/Kanan untuk Skip Instan
              if (action === 'rewind') {
                seekVideo(-10);
                flashIcon('‚è™');
                return;
              }
              if (action === 'forward') {
                seekVideo(10);
                flashIcon('‚è©');
                return;
              }

              // KHUSUS TENGAH: Double tap Like, Single tap Play/Pause
              if (action === 'playpause') {
                const currentTime = Date.now();
                const tapLength = currentTime - lastTapTime;
                lastTapTime = currentTime;

                if (tapLength < 300 && tapLength > 0) {
                  clearTimeout(clickTimer);
                  react('‚ù§Ô∏è');
                  flashIcon('‚ù§Ô∏è');
                } else {
                  clickTimer = setTimeout(() => {
                    togglePlayPause();
                  }, 250);
                }
              }
            }
          };

          layer.addEventListener('pointerup', handlePointerUp);
          layer.addEventListener('pointercancel', () => {
            clearTimeout(longPressTimer);
            startX = 0;
          });
        };

        const initDrag = () => {
          let rAFDrag = null;
          const contentSheet = domRefs.mobileSheet.querySelector('.story-sheet__content');

          const move = (e) => {
            if (!state.isDragging || window.innerWidth >= 768) return;
            if (e.cancelable) e.preventDefault();
            if (rAFDrag) cancelAnimationFrame(rAFDrag);
            rAFDrag = requestAnimationFrame(() => {
              const y = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
              state.currentY = y - state.startY;
              if (state.currentY < 0) state.currentY = state.currentY * 0.2;
              contentSheet.style.transform = `translateY(${state.currentY > 0 ? state.currentY : state.currentY}px)`;
            });
          };
          const end = () => {
            if (!state.isDragging || window.innerWidth >= 768) return;
            state.isDragging = false;
            contentSheet.classList.remove('is-dragging');
            window.removeEventListener('mousemove', move);
            window.removeEventListener('touchmove', move);
            window.removeEventListener('mouseup', end);
            window.removeEventListener('touchend', end);
            if (state.currentY > 120) closeContext();
            else contentSheet.style.transform = '';
            state.currentY = 0;
          };
          const start = (e) => {
            if (window.innerWidth >= 768) return;
            state.startY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            state.isDragging = true;
            contentSheet.classList.add('is-dragging');
            window.addEventListener('mousemove', move);
            window.addEventListener('touchmove', move, { passive: false });
            window.addEventListener('mouseup', end);
            window.addEventListener('touchend', end);
          };

          if (domRefs.mobileHandle) {
            domRefs.mobileHandle.addEventListener('mousedown', start);
            domRefs.mobileHandle.addEventListener('touchstart', start, { passive: true });
          }
        };

        const initEventListeners = () => {
          initProgressBarGestures();
          initGestures();
          initDrag();

          document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || state.isOpen || state.isAnimating)
              return;
            if (e.code === 'Space') {
              e.preventDefault();
              togglePlayPause();
            } else if (e.code === 'ArrowDown') nextVideo();
            else if (e.code === 'ArrowUp') prevVideo();
            else if (e.code === 'ArrowRight') {
              seekVideo(10);
              flashIcon('‚è©');
            } else if (e.code === 'ArrowLeft') {
              seekVideo(-10);
              flashIcon('‚è™');
            }
          });

          document.addEventListener('click', (e) => {
            const target = e.target;
            if (target.closest('.story-close-btn') || target.closest('.overlay-backdrop')) return closeContext();

            const reactionBtn = target.closest('.reaction-option-btn');
            if (reactionBtn) {
              const emoji = reactionBtn.getAttribute('data-reaction');
              return react(emoji, e);
            }

            if (target.closest('#btnPlayPause')) {
              togglePlayPause();
              return;
            }
            if (target.closest('#btnMute')) return toggleMute(e);
            if (target.closest('#btnPrevStory')) return prevVideo(e);
            if (target.closest('#btnNextStory')) return nextVideo(e);
            if (target.closest('#btnStoryClosePlayer')) return closeStory(e);
            if (target.closest('#btnOpenContext')) return openContext();
            if (target.closest('#btnToggleReaction')) return toggleReactionMenu(e);
            if (target.closest('#btnShare')) return nativeShare();
            if (target.closest('#btnCleanMode')) return toggleCleanMode(e);

            if (domRefs.reactionWrapper && !domRefs.reactionWrapper.contains(target)) closeReactionMenu();
          });
        };

        initEventListeners();

        return { startProgressBar, stopProgressBar, checkNavState };
      })();

      function loadYouTubeAPI() {
        var tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
      }

      function onYouTubeIframeAPIReady() {
        updateVideoUI();
        const initialVideoId = videoPlaylist[currentVideoIndex].id;

        const ytOptions = {
          videoId: initialVideoId,
          playerVars: {
            autoplay: 1,
            controls: 0,
            loop: 0,
            mute: 1,
            modestbranding: 1,
            iv_load_policy: 3,
            rel: 0,
            playsinline: 1,
          },
        };

        player = new YT.Player('youtubePlayer', {
          ...ytOptions,
          events: {
            onReady: (e) => {
              e.target.mute();
              e.target.playVideo();
              document.getElementById('youtubePlayer').style.opacity = '1';
              document.getElementById('layoutWrapper').classList.add('is-ready');
            },
            onError: (e) => {
              console.error('YouTube Player Error:', e.data);
              document.getElementById('layoutWrapper').classList.add('is-ready');
            },
            onStateChange: (e) => {
              const btn = document.getElementById('btnPlayPause');
              const container = document.getElementById('storyContainer');

              if (e.data === YT.PlayerState.PLAYING) {
                if (btn) btn.innerText = '‚è∏Ô∏è';
                container.classList.remove('is-paused');
                if (ambientPlayer && typeof ambientPlayer.playVideo === 'function') {
                  ambientPlayer.seekTo(player.getCurrentTime(), true);
                  ambientPlayer.playVideo();
                }
                StoryManager.startProgressBar();
              } else if (e.data === YT.PlayerState.PAUSED) {
                if (btn) btn.innerText = '‚ñ∂Ô∏è';
                container.classList.add('is-paused');
                StoryManager.stopProgressBar();
                if (ambientPlayer && typeof ambientPlayer.pauseVideo === 'function') ambientPlayer.pauseVideo();
              } else if (e.data === YT.PlayerState.BUFFERING) {
                if (ambientPlayer && typeof ambientPlayer.pauseVideo === 'function') ambientPlayer.pauseVideo();
              } else if (e.data === YT.PlayerState.ENDED) {
                StoryManager.stopProgressBar();
                e.target.seekTo(0);
                e.target.playVideo();
              }
            },
          },
        });

        if (window.innerWidth >= 768) {
          ambientPlayer = new YT.Player('ambientPlayer', {
            ...ytOptions,
            events: {
              onReady: (e) => {
                e.target.mute();
                e.target.playVideo();
                document.getElementById('ambientPlayer').style.opacity = '1';
              },
            },
          });
        }
      }

      loadYouTubeAPI();
    </script>
  </body>
</html>
