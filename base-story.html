<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Telkomsel Story - The Perfect Masterpiece</title>
    <style>
      :root {
        --brand-red: #ee2d24;
        --brand-dark: #050505;
        --surface: #ffffff;
        --bg-gray: #f8f9fa;
        --text-main: #111111;
        --text-sub: #555555;
        --glass-bg: rgba(20, 20, 20, 0.6);
        --glass-border: rgba(255, 255, 255, 0.15);
        --ease-out: cubic-bezier(0.25, 1, 0.5, 1);
        --ease-spring: cubic-bezier(0.34, 1.5, 0.64, 1);
        --card-width: 420px;
        --fab-size: 44px;
        --frame-radius: 16px;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: transparent;
      }
      body {
        background: #0f0f11;
        font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
        overflow: hidden;
        color: var(--text-main);
      }
      :is(.story-excerpt, button):focus-visible {
        outline: 2px solid var(--brand-red);
        outline-offset: 2px;
      }

      /* ================= LAYOUT UTAMA ================= */
      .layout-wrapper {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100dvh;
        width: 100vw;
        touch-action: pan-y;
        opacity: 0;
        transition: opacity 0.5s var(--ease-out);
      }
      .layout-wrapper.is-ready {
        opacity: 1;
      }

      .desktop-slider {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100dvh;
        width: 100%;
        transition: padding 0.7s var(--ease-spring);
      }
      .story-group-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100dvh;
        width: 100%;
        transition: transform 0.6s var(--ease-spring);
      }

      .story-container {
        position: relative;
        height: 100dvh;
        width: 100%;
        max-width: calc(100dvh * 9 / 16);
        min-width: 320px;
        background: var(--brand-dark);
        overflow: hidden;
        z-index: 10;
        border-radius: var(--frame-radius);
        transition:
          border-radius 0.6s var(--ease-out),
          box-shadow 0.6s var(--ease-out);
        transform: translateZ(0);
      }

      /* ================= LAYER VIDEO & AMBIENT ================= */
      .ambient-layer {
        display: none;
        position: absolute;
        top: 5%;
        left: 0;
        right: 0;
        margin: 0 auto;
        width: 110%;
        height: 90%;
        z-index: 1;
        filter: blur(50px) saturate(150%);
        opacity: 0.4;
        pointer-events: none;
        transition: opacity 0.8s ease;
        transform: scale(1.05);
      }
      .story-container.is-focused .ambient-layer {
        opacity: 0.25;
      }
      #ambientPlayer {
        width: 100%;
        height: 100%;
        border: none;
        opacity: 0;
        transition: opacity 1s var(--ease-out);
      }

      .story-viewport {
        position: absolute;
        inset: 0;
        z-index: 10;
        overflow: hidden;
        border-radius: inherit;
        transition:
          filter 0.6s var(--ease-out),
          transform 0.6s var(--ease-out);
        will-change: filter, transform;
      }
      .story-video-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: var(--brand-dark);
      }
      .story-video-wrapper::after {
        content: '';
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: 5;
        background: linear-gradient(
          to bottom,
          rgba(0, 0, 0, 0.2) 0,
          transparent 20%,
          transparent 65%,
          rgba(0, 0, 0, 0.85) 100%
        );
        transition: opacity 0.4s var(--ease-out);
      }

      #youtubePlayer {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        border: none;
        pointer-events: none;
        object-fit: cover;
        opacity: 0;
        transition: opacity 0.8s var(--ease-out);
      }

      /* ================= LAYER EFEK & GESTURE ================= */
      #reaction-container {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 15;
        overflow: hidden;
        contain: strict;
      }
      .particle {
        position: absolute;
        top: -10%;
        left: var(--x);
        font-size: var(--size);
        opacity: 0;
        animation: drop-physics var(--duration) ease-in forwards;
        animation-delay: var(--delay);
        filter: blur(var(--blur)) drop-shadow(0 2px 6px rgba(0, 0, 0, 0.4));
        z-index: var(--z);
        will-change: transform, opacity;
      }

      @keyframes drop-physics {
        0% {
          transform: translate3d(0, 0, 0) rotate(0deg);
          opacity: 0;
        }
        10%,
        80% {
          opacity: 1;
        }
        100% {
          transform: translate3d(var(--drift), 120vh, 0) rotate(var(--rotation));
          opacity: 0;
        }
      }

      .story-center-play {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(1.5);
        font-size: 80px;
        z-index: 15;
        opacity: 0;
        pointer-events: none;
        transition:
          opacity 0.4s ease-out,
          transform 0.4s ease-out;
        filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.5));
        will-change: transform, opacity;
      }
      :is(.story-center-play.is-flashing, .story-center-play.is-steady) {
        opacity: 0.9;
        transform: translate(-50%, -50%) scale(1);
        transition:
          opacity 0.1s ease-in,
          transform 0.2s var(--ease-spring);
      }

      .story-gesture-layer {
        position: absolute;
        inset: 0;
        z-index: 20;
        display: flex;
        cursor: pointer;
        touch-action: none;
        user-select: none;
        -webkit-touch-callout: none;
      }
      .gesture-zone {
        height: 100%;
      }
      .gesture-zone--left,
      .gesture-zone--right {
        width: 30%;
      }
      .gesture-zone--center {
        width: 40%;
      }

      /* ================= PROGRESS BAR & FLOATING UI ================= */
      .story-progress-bar-wrapper {
        position: absolute;
        bottom: max(16px, env(safe-area-inset-bottom));
        left: 16px;
        right: 16px;
        height: 24px;
        z-index: 30;
        cursor: pointer;
        display: flex;
        align-items: center;
        opacity: 0;
        transition: opacity 0.8s var(--ease-out);
      }
      .story-progress-bar {
        width: 100%;
        height: 4px;
        background: rgba(255, 255, 255, 0.25);
        border-radius: 4px;
        overflow: hidden;
        transition: height 0.2s var(--ease-out);
      }
      .story-progress-bar-wrapper:hover .story-progress-bar {
        height: 8px;
      }
      .story-progress-bar__fill {
        height: 100%;
        width: 100%;
        background: rgba(255, 255, 255, 0.95);
        transform-origin: left;
        transform: scaleX(0);
        border-radius: inherit;
        box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
        will-change: transform;
      }

      :is(.story-top-actions, .story-player-actions) {
        position: absolute;
        z-index: 40;
        display: flex;
        gap: 12px;
        opacity: 0;
        pointer-events: none;
        transition:
          opacity 0.8s var(--ease-out),
          transform 0.8s var(--ease-spring);
      }
      .story-top-actions {
        top: max(16px, env(safe-area-inset-top));
        left: 16px;
        transform: translateY(-20px);
      }
      .story-player-actions {
        bottom: max(48px, env(safe-area-inset-bottom));
        right: 16px;
        flex-direction: column;
        align-items: center;
        transform: translateY(20px);
      }

      .story-excerpt {
        position: absolute;
        bottom: max(48px, env(safe-area-inset-bottom));
        left: 20px;
        right: 20px;
        padding-right: 70px;
        z-index: 40;
        color: #fff;
        cursor: pointer;
        opacity: 0;
        pointer-events: none;
        transform: translateY(20px);
        transition:
          opacity 0.8s var(--ease-out),
          transform 0.8s var(--ease-spring);
        background: transparent;
        border: none;
        text-align: left;
        font-family: inherit;
        display: block;
      }
      .story-excerpt__badge {
        background: rgba(255, 255, 255, 0.15);
        color: #fff;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 0.5px solid var(--glass-border);
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        padding: 6px 12px;
        border-radius: 8px;
        display: inline-block;
        margin-bottom: 12px;
      }
      .story-excerpt__title {
        font-size: 20px;
        font-weight: 800;
        margin-bottom: 8px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.6);
        line-height: 1.2;
      }
      .story-excerpt__text {
        font-size: 14px;
        line-height: 1.5;
        opacity: 0.9;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-shadow: 0 1px 8px rgba(0, 0, 0, 0.6);
      }

      :is(.player-fab, .reaction-option-btn, .external-nav-btn) {
        width: var(--fab-size);
        height: var(--fab-size);
        border-radius: 50%;
        background: var(--glass-bg);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid var(--glass-border);
        color: #fff;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      :is(.player-fab, .reaction-option-btn, .external-nav-btn):active:not(.is-disabled) {
        background: rgba(255, 255, 255, 0.1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        transform: scale(0.9);
      }
      .external-nav-btn.is-disabled {
        opacity: 0.3;
        cursor: not-allowed;
        pointer-events: none;
      }

      .reaction-wrapper {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .reaction-options {
        position: absolute;
        bottom: 100%;
        right: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        pointer-events: none;
        padding-bottom: 12px;
      }
      .reaction-wrapper.is-active .reaction-options {
        pointer-events: auto;
      }

      .reaction-option-btn {
        font-size: 20px;
        opacity: 0;
        transform: translateY(20px) scale(0.6);
        transition: all 0.4s var(--ease-spring);
      }
      .reaction-wrapper.is-active .reaction-option-btn {
        opacity: 1;
        transform: translateY(0) scale(1);
        margin-bottom: 10px;
      }
      .reaction-wrapper.is-active .player-fab {
        background: rgba(255, 255, 255, 0.9);
        color: var(--brand-dark);
      }

      .reaction-option-btn:nth-child(1) {
        transition-delay: 0s;
      }
      .reaction-option-btn:nth-child(2) {
        transition-delay: 0.04s;
      }
      .reaction-option-btn:nth-child(3) {
        transition-delay: 0.08s;
      }
      .reaction-option-btn:nth-child(4) {
        transition-delay: 0.12s;
      }
      .reaction-wrapper.is-active .reaction-option-btn:nth-child(4) {
        transition-delay: 0s;
      }
      .reaction-wrapper.is-active .reaction-option-btn:nth-child(3) {
        transition-delay: 0.05s;
      }
      .reaction-wrapper.is-active .reaction-option-btn:nth-child(2) {
        transition-delay: 0.1s;
      }
      .reaction-wrapper.is-active .reaction-option-btn:nth-child(1) {
        transition-delay: 0.15s;
      }

      /* Tampilkan UI saat ready */
      .layout-wrapper.is-ready
        :is(.story-excerpt, .story-player-actions, .story-progress-bar-wrapper, .story-top-actions) {
        opacity: 1;
        pointer-events: auto;
        transform: translateY(0);
      }

      /* ================= LOADER & DESKTOP CONTROLS ================= */
      .story-loader {
        position: absolute;
        inset: 0;
        z-index: 50;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--brand-dark);
        transition: opacity 0.4s var(--ease-out);
        pointer-events: none;
      }
      .story-loader__spinner {
        width: 42px;
        height: 42px;
        border: 3.5px solid rgba(255, 255, 255, 0.1);
        border-top-color: var(--brand-red);
        border-radius: 50%;
        animation: spin 1s cubic-bezier(0.5, 0, 0.5, 1) infinite;
      }
      @keyframes spin {
        100% {
          transform: rotate(360deg);
        }
      }
      .layout-wrapper.is-ready .story-loader {
        opacity: 0;
      }

      .desktop-controls-wrapper {
        position: fixed;
        right: 16px;
        top: 0;
        bottom: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        pointer-events: none;
        z-index: 50;
        opacity: 0;
        transition: opacity 0.8s var(--ease-out);
      }
      .layout-wrapper.is-ready .desktop-controls-wrapper {
        opacity: 1;
      }
      .desktop-controls-wrapper > * {
        pointer-events: auto;
      }

      .story-close-player {
        position: fixed;
        top: max(16px, env(safe-area-inset-top));
        right: 16px;
      }
      .external-nav-group {
        display: none;
        flex-direction: column;
        gap: 12px;
      }

      /* ================= CLEAN MODE ================= */
      .layout-wrapper.is-clean-mode :is(.reaction-wrapper, .share-fab, .story-excerpt, .story-top-actions) {
        opacity: 0 !important;
        pointer-events: none !important;
        visibility: hidden !important;
      }
      .layout-wrapper.is-clean-mode .story-top-actions {
        transform: translateY(-20px) !important;
      }
      .layout-wrapper.is-clean-mode .story-video-wrapper::after {
        opacity: 0 !important;
        visibility: hidden !important;
      }
      .layout-wrapper.is-clean-mode #icon-enter-fs {
        display: none !important;
      }
      .layout-wrapper.is-clean-mode #icon-exit-fs {
        display: block !important;
      }

      /* ================= POPUP, SHEET & CARD ================= */
      .story-card {
        display: none;
        width: var(--card-width);
        max-height: calc(100dvh - 80px);
        background: var(--surface);
        border-radius: var(--frame-radius);
        padding: 24px 0 0;
        z-index: 100;
        position: relative;
        flex-direction: column;
        overflow: hidden;
        box-shadow: 0 32px 72px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      .overlay-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
        opacity: 0;
        transition: opacity 0.5s;
        pointer-events: auto;
        touch-action: none;
      }
      .is-active .overlay-backdrop {
        opacity: 1;
      }

      :is(.story-sheet, .story-popup) {
        position: fixed;
        inset: 0;
        z-index: 100;
        visibility: hidden;
        pointer-events: none;
      }
      .story-sheet {
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
      }
      .story-popup {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      :is(.story-sheet, .story-popup).is-active {
        visibility: visible;
      }

      :is(.story-sheet__content, .story-popup__content) {
        position: relative;
        background: var(--surface);
        z-index: 101;
        pointer-events: auto;
        display: flex;
        flex-direction: column;
      }
      .story-sheet__content {
        border-radius: 28px 28px 0 0;
        width: 100%;
        padding: 12px 0 0;
        transform: translateY(100%);
        max-height: 88vh;
        transition: transform 0.6s var(--ease-spring);
        box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.2);
        will-change: transform;
      }
      .story-sheet.is-active .story-sheet__content {
        transform: translateY(0);
      }
      .story-sheet__content.is-dragging {
        transition: transform 0.1s ease-out;
      }

      .story-sheet__handle-wrapper {
        width: 100%;
        padding: 10px 0 24px;
        cursor: grab;
        display: flex;
        justify-content: center;
        flex-shrink: 0;
        touch-action: none;
      }
      .story-sheet__handle {
        width: 44px;
        height: 5px;
        background: #d1d1d6;
        border-radius: 10px;
      }

      .story-popup__content {
        width: var(--card-width);
        padding: 24px 0;
        opacity: 0;
        transform: translateY(40px);
        max-height: calc(100dvh - 64px);
        border-radius: var(--frame-radius);
        transition:
          transform 0.6s var(--ease-spring),
          opacity 0.6s var(--ease-spring);
        box-shadow: 0 24px 64px rgba(0, 0, 0, 0.25);
      }
      .story-popup.is-active .story-popup__content {
        opacity: 1;
        transform: translateY(0);
      }

      .story-close-btn {
        position: absolute;
        top: 16px;
        right: 16px;
        width: 36px;
        height: 36px;
        border: none;
        background: var(--bg-gray);
        border-radius: 50%;
        font-size: 14px;
        font-weight: bold;
        color: var(--text-sub);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s;
        z-index: 30;
      }

      :is(.story-dynamic-area, .story-view) {
        display: flex;
        flex-direction: column;
        min-height: 0;
        flex: 1 1 auto;
      }
      .story-header {
        flex-shrink: 0;
        padding: 0 64px 0 28px;
        margin-bottom: 16px;
      }
      .story-view__title {
        font-size: 24px;
        font-weight: 800;
        color: var(--text-main);
        margin-bottom: 6px;
        line-height: 1.25;
        outline: none;
      }
      .story-view__meta {
        font-size: 13px;
        font-weight: 500;
        color: #888;
        display: block;
      }
      .story-body {
        flex: 1 1 auto;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        padding: 0 28px 32px;
        min-height: 0;
        overscroll-behavior-y: contain;
      }
      .story-body::-webkit-scrollbar {
        width: 5px;
      }
      .story-body::-webkit-scrollbar-thumb {
        background: #d1d1d6;
        border-radius: 10px;
      }
      .story-body::-webkit-scrollbar-track {
        background: transparent;
        margin: 8px 0;
      }
      .story-body__cms-content {
        font-size: 15px;
        color: var(--text-sub);
        line-height: 1.6;
      }
      .story-body__cms-content p {
        margin-bottom: 16px;
      }

      /* ================= HOVER EFFECTS ================= */
      @media (hover: hover) and (pointer: fine) {
        .layout-wrapper.is-ready .story-excerpt:hover {
          opacity: 0.9;
        }
        :is(.player-fab, .reaction-option-btn, .external-nav-btn:not(.is-disabled)):hover {
          background: rgba(255, 255, 255, 0.25);
          box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        .story-close-btn:hover {
          background: #e9ecef;
          color: var(--text-main);
        }
      }

      /* ================= RESPONSIVE ================= */
      @media (max-width: 767px) {
        :is(.story-container, .story-viewport) {
          border-radius: 0 !important;
        }
        .story-popup {
          display: none !important;
        }
        .story-group-wrapper {
          width: 100%;
        }
        .story-header {
          padding: 0 28px;
        }
        .layout-wrapper.is-ui-open .story-viewport {
          filter: blur(12px) brightness(0.5);
          transform: scale(0.97);
          border-radius: var(--frame-radius) !important;
        }
        .layout-wrapper.is-ui-open :is(.story-close-player, .story-excerpt, .story-player-actions, .story-top-actions) {
          opacity: 0;
          pointer-events: none;
        }
        .layout-wrapper.is-clean-mode .story-close-player {
          opacity: 0 !important;
          pointer-events: none !important;
          visibility: hidden !important;
        }
      }

      @media (min-width: 768px) {
        .story-sheet {
          display: none !important;
        }
        .ambient-layer {
          display: block;
        }
        .story-container {
          width: auto;
          height: 100%;
          aspect-ratio: 9/16;
          overflow: visible;
          box-shadow: 0 24px 64px rgba(0, 0, 0, 0.4);
        }
        .external-nav-group {
          display: flex;
          margin: auto 0;
        }

        /* TABLET KHUSUS */
        @media (max-width: 1365px) {
          .story-group-wrapper {
            height: calc(100dvh - 64px);
            width: auto;
          }
          .desktop-controls-wrapper {
            right: 32px;
          }
          .story-close-player {
            position: relative;
            top: max(24px, env(safe-area-inset-top));
            right: auto;
          }
          .layout-wrapper.is-ui-open .desktop-controls-wrapper {
            opacity: 0;
            pointer-events: none;
          }
          .layout-wrapper.is-ui-open .story-viewport {
            filter: blur(12px) brightness(0.6);
            transform: scale(0.97);
          }
          .layout-wrapper.is-ui-open :is(.story-excerpt, .story-player-actions, .story-top-actions) {
            opacity: 0;
            pointer-events: none;
          }
        }
      }

      @media (min-width: 1366px) {
        .story-popup {
          display: none !important;
        }
        .ambient-layer {
          opacity: 0.6;
        }
        .story-group-wrapper {
          width: max-content;
          height: calc(100dvh - 80px);
          position: relative;
          margin: 0 auto;
        }
        .story-container {
          z-index: 10;
        }
        .layout-wrapper.is-ui-open .story-group-wrapper {
          transform: translateX(calc((var(--card-width) + 16px) / -2));
        }

        .story-card {
          display: flex;
          position: fixed;
          right: -500px;
          top: 50%;
          transform: translateY(-50%);
          margin: 0;
          opacity: 0;
          pointer-events: none;
          transition: all 0.6s var(--ease-spring);
          z-index: 100;
        }
        .layout-wrapper.is-ui-open .story-card {
          opacity: 1;
          pointer-events: auto;
          right: 100px;
        }

        .desktop-controls-wrapper {
          right: 40px;
        }
        .story-close-player {
          position: relative;
          top: max(32px, env(safe-area-inset-top));
          right: auto;
        }

        .layout-wrapper.is-ui-open .desktop-controls-wrapper,
        .layout-wrapper.is-ui-open .story-player-actions,
        .layout-wrapper.is-ui-open .story-top-actions {
          opacity: 1;
          pointer-events: auto;
        }
        .layout-wrapper.is-ui-open .story-excerpt {
          opacity: 0;
          pointer-events: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="layout-wrapper" id="layoutWrapper" tabindex="-1">
      <div class="desktop-slider">
        <div class="story-group-wrapper" id="storyGroupWrapper">
          <div class="story-container" id="storyContainer">
            <div class="ambient-layer"><div id="ambientPlayer"></div></div>
            <div class="story-viewport">
              <div class="story-loader"><div class="story-loader__spinner"></div></div>
              <div class="story-video-wrapper"><div id="youtubePlayer"></div></div>

              <div id="reaction-container"></div>
              <div class="story-center-play" id="centerPlayIndicator" aria-hidden="true">‚ñ∂Ô∏è</div>

              <div class="story-gesture-layer" id="storyGestureLayer">
                <div class="gesture-zone gesture-zone--left" data-action="rewind"></div>
                <div class="gesture-zone gesture-zone--center" data-action="playpause"></div>
                <div class="gesture-zone gesture-zone--right" data-action="forward"></div>
              </div>

              <div class="story-progress-bar-wrapper" id="storyProgressBarWrapper" aria-label="Progress Video">
                <div class="story-progress-bar">
                  <div class="story-progress-bar__fill" id="storyProgressFill"></div>
                </div>
              </div>

              <div class="story-top-actions">
                <button class="player-fab" id="btnPlayPause" aria-label="Pause Video">‚è∏Ô∏è</button>
                <button class="player-fab" id="btnMute" aria-label="Mute Audio">üîá</button>
              </div>

              <button class="story-excerpt" id="btnOpenContext" aria-label="Buka Detail Video">
                <span class="story-excerpt__badge">Kategori</span>
                <h2 class="story-excerpt__title">Judul Video</h2>
                <div class="story-excerpt__text">Deskripsi singkat video...</div>
              </button>

              <div class="story-player-actions">
                <div class="reaction-wrapper" id="reactionWrapper">
                  <div class="reaction-options">
                    <button class="reaction-option-btn" aria-label="Beri reaksi Hati" data-reaction="‚ù§Ô∏è">‚ù§Ô∏è</button>
                    <button class="reaction-option-btn" aria-label="Beri reaksi Api" data-reaction="üî•">üî•</button>
                    <button class="reaction-option-btn" aria-label="Beri reaksi Tertawa" data-reaction="ü§£">ü§£</button>
                    <button class="reaction-option-btn" aria-label="Beri reaksi Tepuk Tangan" data-reaction="üëèüèª">
                      üëèüèª
                    </button>
                    <button class="reaction-option-btn" aria-label="Beri reaksi Menangis" data-reaction="üò≠">üò≠</button>
                  </div>
                  <button class="player-fab" id="btnToggleReaction" aria-label="Pilih Reaksi" aria-expanded="false">
                    ü§ç
                  </button>
                </div>
                <button class="player-fab share-fab" id="btnShare" aria-label="Bagikan Tautan">üîó</button>
                <button class="player-fab fullscreen-fab" id="btnCleanMode" aria-label="Mode Bersih">
                  <span id="icon-enter-fs">üî≤</span><span id="icon-exit-fs" style="display: none">‚úñÔ∏è</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="story-card" id="storyCardDashboard">
          <button class="story-close-btn" aria-label="Tutup Detail">‚úñÔ∏è</button>
          <div class="story-dynamic-area"></div>
        </div>

        <div class="desktop-controls-wrapper">
          <button class="player-fab story-close-player" id="btnStoryClosePlayer" aria-label="Tutup Story">‚úñÔ∏è</button>
          <div class="external-nav-group">
            <button id="btnPrevStory" class="external-nav-btn" aria-label="Video Sebelumnya">üîº</button>
            <button id="btnNextStory" class="external-nav-btn" aria-label="Video Selanjutnya">üîΩ</button>
          </div>
        </div>
      </div>

      <div class="story-sheet" id="storySheet" aria-modal="true" role="dialog">
        <div class="story-sheet__backdrop overlay-backdrop"></div>
        <div class="story-sheet__content">
          <div class="story-sheet__handle-wrapper" id="storySheetHandle"><div class="story-sheet__handle"></div></div>
          <div class="story-dynamic-area"></div>
        </div>
      </div>

      <div class="story-popup" id="storyPopup" aria-modal="true" role="dialog">
        <div class="story-popup__backdrop overlay-backdrop"></div>
        <div class="story-popup__content">
          <button class="story-close-btn" aria-label="Tutup Detail">‚úñÔ∏è</button>
          <div class="story-dynamic-area"></div>
        </div>
      </div>
    </div>

    <template id="storyContentTemplate">
      <div class="story-view is-active">
        <div class="story-header">
          <h3 class="story-view__title" tabindex="-1">Judul</h3>
          <span class="story-view__meta" id="storyMeta">Informasi ‚Ä¢ Meta</span>
        </div>
        <div class="story-body" tabindex="0">
          <div class="story-body__cms-content"></div>
        </div>
      </div>
    </template>

    <script>
      let player, ambientPlayer;
      let currentVideoIndex = 0;

      const videoPlaylist = [
        {
          id: 'lxSM-MYJsA8',
          badge: 'Match Highlight',
          title: 'Highlight Lengkap Gol Liga Champions Matchday 7! üî•',
          meta: 'UEFA Champions League ‚Ä¢ 2 Jam yang lalu',
          excerpt:
            'Semua gol dari Matchday ke-7 Liga Champions UEFA! Laga penuh aksi, kejutan tak terduga, dan gol-gol spektakuler.',
          content:
            '<p>Saksikan cuplikan lengkap seluruh gol dari ajang UEFA Champions League Matchday ke-7! Pekan ini menghadirkan laga penuh aksi dan kejutan tak terduga, salah satunya saat Bod√∏/Glimt secara dramatis menumbangkan Manchester City dengan skor 3-1.</p><p>Di laga lain, Arsenal sukses keluar sebagai pemenang dalam duel sengit kontra finalis musim lalu, Inter Milan. Sementara itu, Real Madrid kembali menunjukkan kelasnya dengan melumat AS Monaco 6-1 di hadapan publik sendiri.</p><p>Gol mana yang menjadi favoritmu di pekan ini? Persaingan menuju fase gugur <strong>semakin memanas!</strong></p>',
        },
        {
          id: 'VsVzlXU3u9k',
          badge: 'Tips & Trik',
          title: 'Trik Ampuh Meningkatkan Skill Dribbling Sepak Bola ‚öΩ',
          meta: 'Football Skills ‚Ä¢ 5 Jam yang lalu',
          excerpt:
            'Panduan latihan penguasaan bola jarak dekat, kecepatan, dan kelincahan berbelok untuk melewati bek lawan dengan mudah.',
          content:
            '<p>Latihan ini berfokus pada penguasaan <i>close control</i>, kecepatan menggiring bola, dan kelincahan berbelok. Mulailah dengan berlatih dribbling menggunakan sisi dalam dan luar kaki melewati rintangan (<i>cones</i>). Latihan dasar ini sangat penting agar kamu terbiasa menembus rapatnya barisan pertahanan lawan.</p><p>Setelah itu, tingkatkan intensitas dengan melakukan <i>zigzag turns</i> secara cepat dan tajam. Ingat, sentuhan pertama (<i>first touch</i>) yang sempurna akan memberimu waktu ekstra untuk mengambil keputusan krusial sebelum melepaskan tembakan mematikan (<i>finishing</i>) ke gawang lawan.</p>',
        },
        {
          id: 'jqbr2VED--0',
          badge: 'Update Transfer',
          title: 'Update Bursa Transfer: Manuver Mengejutkan Arsenal & Liverpool üí∏',
          meta: 'Transfer News ‚Ä¢ 1 Hari yang lalu',
          excerpt:
            'Arsenal incar Julian Alvarez, Liverpool bahas potensi penjualan Andy Robertson, serta update "Here We Go" terbaru.',
          content:
            '<p>Bursa transfer musim ini kembali memanas! Kabar mengejutkan datang dari kubu Arsenal yang dilaporkan tengah serius membidik <strong>Julian Alvarez</strong> guna mempertajam lini serang mereka.</p><p>Di tempat lain, Liverpool dikabarkan sedang melakukan pembicaraan intensif terkait potensi penjualan bek sayap andalan mereka, Andy Robertson. Tak ketinggalan, ada konfirmasi <i>"Here We Go"</i> terbaru dari jurnalis pakar transfer Fabrizio Romano mengenai pergerakan taktis Aston Villa. Efek domino dari rentetan transfer ini diprediksi akan segera mengubah peta kekuatan tim-tim elite Eropa!</p>',
        },
      ];

      const updateEls = (sel, prop, val) => document.querySelectorAll(sel).forEach((el) => (el[prop] = val));

      const updateVideoUI = () => {
        const data = videoPlaylist[currentVideoIndex];
        const progressFill = document.getElementById('storyProgressFill');
        if (progressFill) progressFill.style.transform = 'scaleX(0)';

        updateEls('.story-excerpt__badge', 'innerText', data.badge);
        updateEls('.story-excerpt__title, .story-view__title', 'innerText', data.title);
        updateEls('.story-excerpt__text', 'innerText', data.excerpt);
        updateEls('.story-view__meta', 'innerText', data.meta);
        updateEls('.story-body__cms-content', 'innerHTML', data.content);

        player?.loadVideoById?.(data.id);
        ambientPlayer?.loadVideoById?.(data.id);

        StoryManager.startProgressBar();
        StoryManager.checkNavState();
      };

      window.StoryManager = (() => {
        const state = {
          isOpen: false,
          startY: 0,
          currentY: 0,
          isDragging: false,
          animFrameId: null,
          isAnimating: false,
        };

        const getDOM = (ids) => ids.reduce((acc, id) => ({ ...acc, [id]: document.getElementById(id) }), {});
        const domRefs = {
          ...getDOM([
            'layoutWrapper',
            'storyProgressBarWrapper',
            'storyProgressFill',
            'storySheet',
            'storySheetHandle',
            'storyPopup',
            'storyCardDashboard',
            'storyContentTemplate',
            'reactionWrapper',
            'btnPlayPause',
            'btnMute',
            'icon-enter-fs',
            'icon-exit-fs',
            'reaction-container',
            'centerPlayIndicator',
            'btnPrevStory',
            'btnNextStory',
            'storyGestureLayer',
            'btnToggleReaction',
            'btnOpenContext',
          ]),
          storyViewport: document.querySelector('.story-viewport'),
        };

        const getActiveContext = () => {
          const w = window.innerWidth;
          return w >= 1366 ? domRefs.storyCardDashboard : w >= 768 ? domRefs.storyPopup : domRefs.storySheet;
        };

        [domRefs.storySheet, domRefs.storyPopup, domRefs.storyCardDashboard].forEach((el) => {
          const target = el?.querySelector('.story-dynamic-area');
          if (target && !target.innerHTML.trim())
            target.appendChild(domRefs.storyContentTemplate.content.cloneNode(true));
        });

        let lastSyncCheck = 0;
        const loopProgress = () => {
          if (!state.isOpen && player?.getPlayerState?.() === YT.PlayerState.PLAYING) {
            const duration = player.getDuration();
            const currentTime = player.getCurrentTime();
            if (duration > 0) domRefs.storyProgressFill.style.transform = `scaleX(${currentTime / duration})`;

            if (ambientPlayer?.getCurrentTime) {
              const now = performance.now();
              if (now - lastSyncCheck > 1000) {
                if (Math.abs(currentTime - ambientPlayer.getCurrentTime()) > 0.4)
                  ambientPlayer.seekTo(currentTime, true);
                lastSyncCheck = now;
              }
            }
            state.animFrameId = requestAnimationFrame(loopProgress);
          } else {
            state.animFrameId = null;
          }
        };

        const startProgressBar = () => {
          cancelAnimationFrame(state.animFrameId);
          domRefs.storyProgressFill.style.transform = 'scaleX(0)';
          state.animFrameId = requestAnimationFrame(loopProgress);
        };

        const stopProgressBar = () => cancelAnimationFrame(state.animFrameId);

        let flashTimeout;
        const toggleIcon = (iconStr, type) => {
          const iconEl = domRefs.centerPlayIndicator;
          if (!iconEl) return;
          clearTimeout(flashTimeout);
          iconEl.innerText = iconStr;
          iconEl.className = type;
          if (type === 'is-flashing') flashTimeout = setTimeout(() => iconEl.classList.remove('is-flashing'), 500);
        };

        const flashIcon = (iconStr) => {
          toggleIcon('', '');
          void domRefs.centerPlayIndicator?.offsetWidth;
          toggleIcon(iconStr, 'is-flashing');
        };
        const showSteadyIcon = (iconStr) => toggleIcon(iconStr, 'is-steady');
        const hideSteadyIcon = () => domRefs.centerPlayIndicator?.classList.remove('is-steady');

        const checkNavState = () => {
          domRefs.btnPrevStory?.classList.toggle('is-disabled', currentVideoIndex === 0);
          domRefs.btnNextStory?.classList.toggle('is-disabled', currentVideoIndex === videoPlaylist.length - 1);
        };

        const resetVideoState = () => {
          if (state.isOpen) closeContext();
          closeReactionMenu();
          if (domRefs['reaction-container']) domRefs['reaction-container'].innerHTML = '';
          domRefs.layoutWrapper?.classList.remove('is-clean-mode');

          // --- TAMBAHAN: Matikan/Sembunyikan cahaya ambient saat transisi ---
          const ambientEl = document.getElementById('ambientPlayer');
          if (ambientEl) ambientEl.style.opacity = '0';
        };

        const seekVideo = (offset) => {
          if (!player?.getDuration) return;
          const duration = player.getDuration();
          if (!duration) return;
          const newTime = Math.max(0, Math.min(player.getCurrentTime() + offset, duration));
          [player, ambientPlayer].forEach((p) => p?.seekTo?.(newTime, true));
          domRefs.storyProgressFill.style.transform = `scaleX(${newTime / duration})`;
        };

        const slideTransition = (direction, callback) => {
          const viewport = domRefs.storyViewport;
          if (!viewport) return callback();
          state.isAnimating = true;

          const dirMultiplier = direction === 'next' ? -1 : 1;
          viewport.style.transition = 'transform 0.35s cubic-bezier(0.32, 0.72, 0, 1), opacity 0.35s ease';
          viewport.style.transform = `translateY(${dirMultiplier * 100}%) scale(0.95)`;
          viewport.style.opacity = '0';

          setTimeout(() => {
            callback();
            viewport.style.transition = 'none';
            viewport.style.transform = `translateY(${dirMultiplier * -100}%) scale(0.95)`;
            void viewport.offsetHeight;
            viewport.style.transition = 'transform 0.45s cubic-bezier(0.34, 1.5, 0.64, 1), opacity 0.4s ease';
            viewport.style.transform = 'translateY(0) scale(1)';
            viewport.style.opacity = '1';
            setTimeout(
              () =>
                Object.assign(
                  viewport.style,
                  { transition: '', transform: '', opacity: '' },
                  (state.isAnimating = false),
                ),
              450,
            );
          }, 350);
        };

        const switchVideo = (step) => {
          if (state.isAnimating) return;
          const newIndex = currentVideoIndex + step;
          if (newIndex >= 0 && newIndex < videoPlaylist.length) {
            resetVideoState(); // <-- Ambient di-hide di sini
            slideTransition(step > 0 ? 'next' : 'prev', () => {
              currentVideoIndex = newIndex;
              updateVideoUI();
            });
          }
        };

        const closeStory = () => {
          [player, ambientPlayer].forEach((p) => p?.pauseVideo?.());
          domRefs.layoutWrapper.style.opacity = '0';
          setTimeout(() => (domRefs.layoutWrapper.style.display = 'none'), 500);
        };

        const togglePlayPause = () => {
          if (player?.getPlayerState?.() === YT.PlayerState.PLAYING) {
            [player, ambientPlayer].forEach((p) => p?.pauseVideo?.());
            flashIcon('‚è∏Ô∏è');
          } else {
            player?.playVideo?.();
            ambientPlayer?.seekTo?.(player.getCurrentTime(), true);
            ambientPlayer?.playVideo?.();
            flashIcon('‚ñ∂Ô∏è');
          }
        };

        const toggleMute = () => {
          const isMuted = player?.isMuted?.();
          isMuted ? player?.unMute?.() : player?.mute?.();
          if (domRefs.btnMute) domRefs.btnMute.innerText = isMuted ? 'üîä' : 'üîá';
        };

        const toggleContext = (open) => {
          const ctx = getActiveContext();
          if (!ctx) return;
          state.isOpen = open;

          domRefs.layoutWrapper?.classList.toggle('is-ui-open', open);
          domRefs.layoutWrapper?.classList.remove('is-clean-mode');
          ctx.classList.toggle('is-active', open);

          if (open) {
            domRefs['icon-enter-fs'].style.display = 'block';
            domRefs['icon-exit-fs'].style.display = 'none';
            if (window.innerWidth < 1366) [player, ambientPlayer].forEach((p) => p?.pauseVideo?.());
            closeReactionMenu();
            setTimeout(() => ctx.querySelector('.story-view__title')?.focus(), 100);
          } else {
            domRefs.storySheet?.classList.remove('is-active');
            domRefs.storyPopup?.classList.remove('is-active');
            domRefs.storyCardDashboard?.classList.remove('is-active');
            domRefs.storySheet.querySelector('.story-sheet__content').style.transform = '';
            if (window.innerWidth < 1366) [player, ambientPlayer].forEach((p) => p?.playVideo?.());
            domRefs.btnOpenContext?.focus();
          }
        };
        const openContext = () => toggleContext(true);
        const closeContext = () => toggleContext(false);

        const toggleReactionMenu = () => {
          const isActive = domRefs.reactionWrapper?.classList.toggle('is-active');
          domRefs.btnToggleReaction?.setAttribute('aria-expanded', isActive);
        };
        const closeReactionMenu = () => {
          domRefs.reactionWrapper?.classList.remove('is-active');
          domRefs.btnToggleReaction?.setAttribute('aria-expanded', 'false');
        };

        const nativeShare = async () => {
          const url = `https://www.youtube.com/watch?v=${videoPlaylist[currentVideoIndex].id}`;
          try {
            if (navigator.share) await navigator.share({ title: videoPlaylist[currentVideoIndex].title, url });
            else {
              navigator.clipboard.writeText(url);
              alert('Tautan berhasil disalin!');
            }
          } catch (e) {}
        };

        const react = (emoji) => {
          const fragment = document.createDocumentFragment();
          for (let i = 0; i < 35; i++) {
            const el = document.createElement('div');
            const depth = Math.random();
            el.className = 'particle';
            el.innerText = emoji;
            el.style.cssText = `--x:${Math.random() * 100}%;--size:${depth * 1.2 + 1.2}rem;--blur:${depth < 0.2 ? '2px' : '0px'};--z:${depth > 0.5 ? 20 : 1};--duration:${3500 - depth * 1500}ms;--delay:${Math.random() * 600}ms;--rotation:${(Math.random() - 0.5) * 720}deg;--drift:${(Math.random() - 0.5) * 120}px;`;
            el.onanimationend = () => el.remove();
            fragment.appendChild(el);
          }
          domRefs['reaction-container']?.appendChild(fragment);
          navigator.vibrate?.(40);

          const mainBtn = domRefs.reactionWrapper?.querySelector('.player-fab');
          if (mainBtn) {
            mainBtn.innerText = emoji;
            setTimeout(() => (mainBtn.innerText = 'ü§ç'), 1500);
          }
          closeReactionMenu();
        };

        // --- GESTURE LOGIC ---
        const getClientX = (e) => e.touches?.[0]?.clientX ?? e.clientX;
        const getClientY = (e) => e.touches?.[0]?.clientY ?? e.clientY;

        const initProgressBarGestures = () => {
          let isScrubbing = false,
            wasPlaying = false;
          const updateSeek = (clientX) => {
            const rect = domRefs.storyProgressBarWrapper.getBoundingClientRect();
            const percentage = Math.max(0, Math.min(1, (clientX - rect.left) / rect.width));
            domRefs.storyProgressFill.style.transform = `scaleX(${percentage})`;
            const newTime = (player?.getDuration?.() ?? 0) * percentage;
            [player, ambientPlayer].forEach((p) => p?.seekTo?.(newTime, true));
          };

          const startScrub = (e) => {
            isScrubbing = true;
            wasPlaying = player?.getPlayerState?.() === YT.PlayerState.PLAYING;
            if (wasPlaying) [player, ambientPlayer].forEach((p) => p?.pauseVideo?.());
            updateSeek(getClientX(e));
          };
          const moveScrub = (e) => {
            if (!isScrubbing) return;
            if (e.cancelable) e.preventDefault();
            updateSeek(getClientX(e));
          };
          const stopScrub = () => {
            if (!isScrubbing) return;
            isScrubbing = false;
            if (wasPlaying) [player, ambientPlayer].forEach((p) => p?.playVideo?.());
          };

          const wrapper = domRefs.storyProgressBarWrapper;
          wrapper?.addEventListener('mousedown', startScrub);
          wrapper?.addEventListener('touchstart', startScrub, { passive: true });
          window.addEventListener('mousemove', moveScrub);
          window.addEventListener('touchmove', moveScrub, { passive: false });
          window.addEventListener('mouseup', stopScrub);
          window.addEventListener('touchend', stopScrub);
        };

        const initGestures = () => {
          let startX = 0,
            startY = 0,
            lastTapTime = 0,
            clickTimer,
            longPressTimer;
          let isLongPressActive = false,
            isSwiping = false,
            holdAction = null;
          const layer = domRefs.storyGestureLayer;

          layer?.addEventListener('contextmenu', (e) => e.preventDefault());
          layer?.addEventListener('pointerdown', (e) => {
            if (state.isAnimating || (e.pointerType === 'mouse' && e.button !== 0)) return;
            startX = e.clientX;
            startY = e.clientY;
            isLongPressActive = isSwiping = false;
            holdAction = e.target.getAttribute('data-action');

            longPressTimer = setTimeout(() => {
              isLongPressActive = true;
              if (holdAction === 'playpause') {
                domRefs.layoutWrapper?.classList.add('is-clean-mode');
                player?.pauseVideo?.();
              } else {
                const rate = holdAction === 'forward' ? 2 : 0.5;
                [player, ambientPlayer].forEach((p) => p?.setPlaybackRate?.(rate));
                showSteadyIcon(holdAction === 'forward' ? '‚è© 2x' : '‚è™ 0.5x');
              }
            }, 400);
          });

          layer?.addEventListener('pointermove', (e) => {
            if (state.isAnimating || !startX) return;
            if (Math.abs(e.clientX - startX) > 10 || Math.abs(e.clientY - startY) > 10) {
              clearTimeout(longPressTimer);
              isSwiping = true;
            }
          });

          layer?.addEventListener('pointerup', (e) => {
            if (state.isAnimating || !startX) return;
            clearTimeout(longPressTimer);
            const dy = e.clientY - startY;
            startX = 0;

            if (isLongPressActive) {
              if (holdAction === 'playpause') {
                domRefs.layoutWrapper?.classList.remove('is-clean-mode');
                player?.playVideo?.();
              } else {
                [player, ambientPlayer].forEach((p) => p?.setPlaybackRate?.(1));
                hideSteadyIcon();
              }
              return;
            }

            if (isSwiping && Math.abs(dy) > 50) return switchVideo(dy > 0 ? -1 : 1);

            if (!isSwiping) {
              if (holdAction === 'rewind') {
                seekVideo(-10);
                flashIcon('‚è™');
                return;
              }
              if (holdAction === 'forward') {
                seekVideo(10);
                flashIcon('‚è©');
                return;
              }
              if (holdAction === 'playpause') {
                const tapLength = Date.now() - lastTapTime;
                lastTapTime = Date.now();
                if (tapLength > 0 && tapLength < 300) {
                  clearTimeout(clickTimer);
                  react('‚ù§Ô∏è');
                  flashIcon('‚ù§Ô∏è');
                } else {
                  clickTimer = setTimeout(togglePlayPause, 250);
                }
              }
            }
          });

          layer?.addEventListener('pointercancel', () => {
            clearTimeout(longPressTimer);
            startX = 0;
          });
        };

        const initDrag = () => {
          let rAFDrag = null;
          const contentSheet = domRefs.storySheet?.querySelector('.story-sheet__content');

          const move = (e) => {
            if (!state.isDragging || window.innerWidth >= 768) return;
            if (e.cancelable) e.preventDefault();
            cancelAnimationFrame(rAFDrag);
            rAFDrag = requestAnimationFrame(() => {
              state.currentY = getClientY(e) - state.startY;
              if (state.currentY < 0) state.currentY *= 0.2;
              contentSheet.style.transform = `translateY(${state.currentY}px)`;
            });
          };
          const end = () => {
            if (!state.isDragging || window.innerWidth >= 768) return;
            state.isDragging = false;
            contentSheet.classList.remove('is-dragging');
            ['mousemove', 'touchmove', 'mouseup', 'touchend'].forEach((evt) =>
              window.removeEventListener(evt, evt.includes('move') ? move : end),
            );
            if (state.currentY > 120) closeContext();
            else contentSheet.style.transform = '';
            state.currentY = 0;
          };
          const start = (e) => {
            if (window.innerWidth >= 768) return;
            state.startY = getClientY(e);
            state.isDragging = true;
            contentSheet.classList.add('is-dragging');
            window.addEventListener('mousemove', move);
            window.addEventListener('touchmove', move, { passive: false });
            window.addEventListener('mouseup', end);
            window.addEventListener('touchend', end);
          };

          domRefs.storySheetHandle?.addEventListener('mousedown', start);
          domRefs.storySheetHandle?.addEventListener('touchstart', start, { passive: true });
        };

        const initEventListeners = () => {
          initProgressBarGestures();
          initGestures();
          initDrag();

          document.addEventListener('keydown', (e) => {
            if (['INPUT', 'TEXTAREA'].includes(e.target.tagName) || state.isOpen || state.isAnimating) return;
            const keyMap = {
              Space: () => {
                e.preventDefault();
                togglePlayPause();
              },
              ArrowDown: () => switchVideo(1),
              ArrowUp: () => switchVideo(-1),
              ArrowRight: () => {
                seekVideo(10);
                flashIcon('‚è©');
              },
              ArrowLeft: () => {
                seekVideo(-10);
                flashIcon('‚è™');
              },
            };
            keyMap[e.code]?.();
          });

          document.addEventListener('click', (e) => {
            const t = e.target;
            if (t.closest('.story-close-btn, .overlay-backdrop')) return closeContext();
            if (t.closest('.reaction-option-btn')) return react(t.closest('.reaction-option-btn').dataset.reaction);

            const actionMap = {
              '#btnPlayPause': togglePlayPause,
              '#btnMute': toggleMute,
              '#btnPrevStory': () => switchVideo(-1),
              '#btnNextStory': () => switchVideo(1),
              '#btnStoryClosePlayer': closeStory,
              '#btnOpenContext': openContext,
              '#btnToggleReaction': toggleReactionMenu,
              '#btnShare': nativeShare,
              '#btnCleanMode': () => {
                closeReactionMenu();
                domRefs.layoutWrapper?.classList.toggle('is-clean-mode');
              },
            };
            for (let selector in actionMap) if (t.closest(selector)) return actionMap[selector](e);

            if (domRefs.reactionWrapper && !domRefs.reactionWrapper.contains(t)) closeReactionMenu();
          });
        };

        initEventListeners();
        return { startProgressBar, stopProgressBar, checkNavState };
      })();

      function loadYouTubeAPI() {
        const tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        document.head.appendChild(tag);
      }

      function onYouTubeIframeAPIReady() {
        updateVideoUI();
        const ytOptions = {
          videoId: videoPlaylist[currentVideoIndex].id,
          playerVars: {
            autoplay: 1,
            controls: 0,
            loop: 0,
            mute: 1,
            modestbranding: 1,
            iv_load_policy: 3,
            rel: 0,
            playsinline: 1,
          },
        };

        player = new YT.Player('youtubePlayer', {
          ...ytOptions,
          events: {
            onReady: (e) => {
              e.target.mute();
              e.target.playVideo();
              document.getElementById('youtubePlayer').style.opacity = '1';
              document.getElementById('layoutWrapper').classList.add('is-ready');
            },
            onError: (e) => {
              console.error('YouTube Error:', e.data);
              document.getElementById('layoutWrapper').classList.add('is-ready');
            },
            onStateChange: (e) => {
              const btn = document.getElementById('btnPlayPause');
              const container = document.getElementById('storyContainer');

              if (e.data === YT.PlayerState.PLAYING) {
                if (btn) btn.innerText = '‚è∏Ô∏è';
                container?.classList.remove('is-paused');

                // Sinkronkan playback ambient
                ambientPlayer?.seekTo?.(player.getCurrentTime(), true);
                ambientPlayer?.playVideo?.();

                // --- TAMBAHAN: Tampilkan cahaya ambient kembali dengan transisi lembut ---
                const ambientEl = document.getElementById('ambientPlayer');
                if (ambientEl) ambientEl.style.opacity = '1';

                StoryManager.startProgressBar();
              } else if (e.data === YT.PlayerState.PAUSED) {
                if (btn) btn.innerText = '‚ñ∂Ô∏è';
                container?.classList.add('is-paused');
                StoryManager.stopProgressBar();
                ambientPlayer?.pauseVideo?.();
              } else if (e.data === YT.PlayerState.BUFFERING) {
                ambientPlayer?.pauseVideo?.();
              } else if (e.data === YT.PlayerState.ENDED) {
                StoryManager.stopProgressBar();
                e.target.seekTo(0);
                e.target.playVideo();
              }
            },
          },
        });

        if (window.innerWidth >= 768) {
          ambientPlayer = new YT.Player('ambientPlayer', {
            ...ytOptions,
            events: {
              onReady: (e) => {
                e.target.mute();
                e.target.playVideo();
                document.getElementById('ambientPlayer').style.opacity = '1';
              },
            },
          });
        }
      }

      loadYouTubeAPI();
    </script>
  </body>
</html>
